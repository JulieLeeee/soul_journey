<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒéˆæ—…ç¨‹ ç·šä¸Šå‘½ç†å åœ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for Noto Sans TC (æ€æºæŸ”é»‘é«”æ›¿ä»£) and Playfair Display -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif; /* ä¸­æ–‡æ€æºæŸ”é»‘é«” */
            background-color: #F0D9D9; /* æŸ”éœ§ç²‰ */
            color: #333333; /* éœ§é»‘ */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* Align content to top */
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            /* æŸ”å’Œçš„èƒŒæ™¯æ¼¸è®Šèˆ‡æ˜Ÿæ˜Ÿé»é» */
            background-image: linear-gradient(to bottom right, #F0D9D9, #F5F5DC), /* æŸ”éœ§ç²‰åˆ°ç±³æç™½æ¼¸è®Š */
                              url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="50" cy="50" r="1.8" fill="rgba(167,217,224,0.7)"/><circle cx="15" cy="85" r="1" fill="rgba(196,193,217,0.6)"/><circle cx="75" cy="25" r="1.3" fill="rgba(167,217,224,0.8)"/><circle cx="30" cy="10" r="0.9" fill="rgba(196,193,217,0.5)"/><circle cx="90" cy="60" r="1.5" fill="rgba(167,217,224,0.9)"/></svg>');
            background-size: cover, 100px 100px;
            background-repeat: no-repeat, repeat;
            background-attachment: fixed; /* å›ºå®šèƒŒæ™¯ï¼Œæ»¾å‹•æ™‚æ˜Ÿæ˜Ÿä¸å‹• */
        }

        /* Navbar Styles */
        nav {
            background-color: rgba(245, 245, 220, 0.9); /* ç±³æç™½åŠé€æ˜ */
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border-radius: 15px; /* Rounded corners for the navbar itself */
        }

        .nav-link {
            color: #6B7280; /* æš–ç° */
            font-weight: 500;
            padding: 12px 20px;
            border-radius: 10px;
            transition: all 0.3s ease-in-out;
        }

        .nav-link:hover {
            background-color: rgba(167, 217, 224, 0.2); /* æ¹–æ°´è—æ·ºè‰²èƒŒæ™¯ */
            color: #4A5568; /* æ·±ä¸€é»çš„æš–ç° */
        }

        .nav-link.active {
            background-color: #A7D9E0; /* æ¹–æ°´è— */
            color: white;
            font-weight: 600;
        }

        .hamburger-menu {
            display: none; /* Hidden by default on desktop */
            flex-direction: column;
            justify-content: space-between;
            width: 30px;
            height: 20px;
            cursor: pointer;
        }

        .hamburger-menu span {
            display: block;
            width: 100%;
            height: 2px;
            background-color: #6B7280;
            border-radius: 2px;
            transition: all 0.3s ease-in-out;
        }

        .hamburger-menu.open span:nth-child(1) {
            transform: translateY(9px) rotate(45deg);
        }
        .hamburger-menu.open span:nth-child(2) {
            opacity: 0;
        }
        .hamburger-menu.open span:nth-child(3) {
            transform: translateY(-9px) rotate(-45deg);
        }

        .mobile-menu {
            background-color: rgba(245, 245, 220, 0.95);
            backdrop-filter: blur(10px);
            position: absolute;
            top: 60px; /* Adjust based on navbar height */
            right: 20px;
            width: calc(100% - 40px); /* Full width minus padding */
            max-width: 300px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            padding: 20px;
            display: none; /* Hidden by default */
            flex-direction: column;
            gap: 10px;
            z-index: 999;
        }

        .mobile-menu .nav-link {
            width: 100%;
            text-align: center;
        }

        @media (max-width: 767px) {
            .navbar-desktop-links {
                display: none; /* Hide desktop links on mobile */
            }
            .hamburger-menu {
                display: flex; /* Show hamburger on mobile */
            }
            /* Adjust body padding for mobile to prevent content being hidden behind navbar */
            body {
                padding-top: 80px; /* Give space for fixed navbar */
            }
        }


        /* Page content styling */
        .page-content {
            width: 100%;
            max-width: 900px; /* Wider for page content */
            padding: 20px 0;
            display: none; /* Hidden by default, shown by JS */
            flex-direction: column; /* Ensures blocks stack correctly */
            align-items: center; /* Centers content within the page */
        }

        .page-content.active {
            display: flex; /* Show active page */
        }

        .intro-section {
            background-color: rgba(245, 245, 220, 0.8); /* ç±³æç™½åŠé€æ˜ */
            backdrop-filter: blur(8px);
            border: 1px solid rgba(196, 193, 217, 0.3); /* éœè¬ç´«é‚Šæ¡† */
            border-radius: 25px; /* æ›´åœ“æ½¤ */
            padding: 35px;
            margin-bottom: 40px;
            max-width: 700px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            color: #6B7280; /* æš–ç° */
            line-height: 1.8;
            font-size: 1.1em;
        }

        .intro-section .illustration-placeholder {
            font-size: 4em; /* Larger emoji for illustration */
            margin-bottom: 20px;
            display: block;
        }

        .card {
            background-color: rgba(245, 245, 220, 0.9); /* ç±³æç™½ï¼Œæ›´ä¸é€æ˜ */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(167, 217, 224, 0.4); /* æ¹–æ°´è—é‚Šæ¡† */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-radius: 20px;
            padding: 30px;
            margin: 20px;
            max-width: 500px; /* ç•¥å¯¬ */
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
        }

        .input-group label {
            color: #6B7280; /* æš–ç°æ¨™ç±¤ */
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input, .input-group select {
            background-color: rgba(255, 255, 255, 0.7); /* æ›´æ·ºçš„èƒŒæ™¯ */
            border: 1px solid rgba(196, 193, 217, 0.5); /* éœè¬ç´«é‚Šæ¡† */
            color: #333333; /* éœ§é»‘æ–‡å­— */
            padding: 12px 18px;
            border-radius: 10px;
            transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #A7D9E0; /* æ¹–æ°´è—èšç„¦è‰² */
            box-shadow: 0 0 0 3px rgba(167, 217, 224, 0.3); /* æ¹–æ°´è—å…‰æšˆ */
        }

        .btn-primary {
            background-image: linear-gradient(to right, #F0D9D9, #FFB6C1); /* æŸ”éœ§ç²‰åˆ°çŠç‘šç²‰æ¼¸è®Š */
            color: #333333; /* éœ§é»‘æ–‡å­— */
            padding: 14px 28px;
            border-radius: 10px;
            font-weight: 700;
            letter-spacing: 0.05em;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 6px 20px rgba(240, 217, 217, 0.4);
            border: 1px solid rgba(255, 182, 193, 0.5); /* çŠç‘šç²‰é‚Šæ¡† */
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(240, 217, 217, 0.6);
            background-image: linear-gradient(to right, #FFB6C1, #F0D9D9);
        }

        .result-title {
            font-size: 2em;
            font-weight: 700;
            color: #8A89A6; /* éœè¬ç´«æ¨™é¡Œ */
            margin-bottom: 20px;
            letter-spacing: 0.03em;
        }

        .result-content {
            font-size: 1.1em;
            line-height: 1.7;
            color: #6B7280; /* æš–ç°å…§å®¹ */
        }

        #loading-indicator {
            display: none;
            margin-top: 30px;
            color: #A7D9E0; /* æ¹–æ°´è— */
            font-size: 1.3em;
            font-weight: 600;
        }

        /* Message Box Styling */
        .message-box-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none; /* Hidden by default */
        }

        .message-box {
            background-color: #F5F5DC; /* ç±³æç™½ */
            border: 1px solid rgba(167, 217, 224, 0.5);
            border-radius: 15px;
            padding: 35px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 450px;
            width: 90%;
            color: #333333;
        }

        .message-box h3 {
            margin-top: 0;
            color: #FFB6C1; /* çŠç‘šç²‰æ¨™é¡Œ */
            font-size: 1.8em;
            margin-bottom: 25px;
        }

        .message-box p {
            margin-bottom: 30px;
            line-height: 1.7;
            color: #6B7280;
        }

        .message-box button {
            background-image: linear-gradient(to right, #A7D9E0, #C4C1D9); /* æ¹–æ°´è—åˆ°éœè¬ç´«æ¼¸è®Š */
            color: white;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 3px 10px rgba(167, 217, 224, 0.4);
        }

        .message-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(167, 217, 224, 0.6);
        }

        .reset-button {
            background-color: #C4C1D9; /* éœè¬ç´« */
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            margin-top: 30px;
            transition: background-color 0.3s ease-in-out;
        }

        .reset-button:hover {
            background-color: #A7D9E0; /* æ¹–æ°´è— */
        }

        /* Chatbot specific styles */
        .chatbot-container {
            background-color: rgba(245, 245, 220, 0.9); /* ç±³æç™½ï¼Œèˆ‡å…¶ä»–å¡ç‰‡ä¸€è‡´ */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(167, 217, 224, 0.4);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-radius: 20px;
            padding: 25px; /* ç•¥å°æ–¼çµæœå¡ç‰‡ï¼Œä¿æŒè¼•ç›ˆæ„Ÿ */
            margin-top: 40px; /* èˆ‡çµæœå¡ç‰‡å€éš” */
            max-width: 600px; /* è¼ƒå¯¬çš„èŠå¤©è¦–çª— */
            width: 100%;
            display: flex;
            flex-direction: column;
            height: 500px; /* Fixed height */
            overflow: hidden; /* Hide scrollbar */
            position: relative; /* For scroll button positioning */
        }

        .chat-messages {
            flex-grow: 1;
            overflow-y: auto; /* Message scroll */
            padding-right: 15px; /* Space for scrollbar */
            margin-bottom: 20px;
            /* Custom scrollbar styles */
            scrollbar-width: thin;
            scrollbar-color: #C4C1D9 #F5F5DC;
        }

        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #F5F5DC;
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background-color: #C4C1D9;
            border-radius: 10px;
            border: 2px solid #F5F5DC;
        }

        .message-bubble {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 15px;
            margin-bottom: 15px;
            line-height: 1.6;
            word-wrap: break-word; /* Prevent long text overflow */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
            white-space: pre-wrap; /* Preserve whitespace and line breaks from LLM */
        }

        .user-message {
            background-color: #E6E6FA; /* Lavender, soft */
            color: #333333;
            margin-left: auto; /* Align right */
            border: 1px solid rgba(196, 193, 217, 0.4);
        }

        .bot-message {
            background-color: #F8F8F0; /* Light beige, softer */
            color: #6B7280;
            margin-right: auto; /* Align left */
            border: 1px solid rgba(167, 217, 224, 0.4);
        }

        .chat-input-area {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input-area input {
            flex-grow: 1;
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(196, 193, 217, 0.6);
            color: #333333;
            padding: 12px 18px;
            border-radius: 10px;
        }

        .chat-input-area input::placeholder {
            color: #A0A0A0; /* Light gray placeholder text */
        }

        .chat-input-area button {
            background-image: linear-gradient(to right, #A7D9E0, #C4C1D9); /* Aqua to Periwinkle gradient */
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 3px 10px rgba(167, 217, 224, 0.4);
        }

        .chat-input-area button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(167, 217, 224, 0.6);
        }

        .chatbot-loading {
            text-align: center;
            color: #A7D9E0;
            margin-top: 10px;
            font-size: 0.9em;
            display: none;
        }

        /* About Section specific styles */
        .about-section-block {
            background-color: rgba(245, 245, 220, 0.8); /* ç±³æç™½åŠé€æ˜ */
            backdrop-filter: blur(8px);
            border: 1px solid rgba(196, 193, 217, 0.3); /* éœè¬ç´«é‚Šæ¡† */
            border-radius: 25px;
            padding: 35px;
            margin-bottom: 40px;
            max-width: 800px; /* Wider about section */
            width: 100%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            color: #6B7280; /* æš–ç° */
            line-height: 1.8;
            font-size: 1.1em;
            display: flex; /* Flexbox for layout */
            flex-direction: column; /* Default to column for mobile */
            align-items: center;
            text-align: center;
        }

        .about-section-block .content-wrapper {
            display: flex;
            flex-direction: column; /* Default to column for mobile */
            align-items: center;
            gap: 20px; /* Space between image and text */
            width: 100%;
        }

        .about-section-block .text-content {
            flex: 1; /* Allow text to take available space */
            text-align: left; /* Align text to left within its column */
        }

        .about-section-block .illustration-wrapper {
            flex-shrink: 0; /* Don't shrink image */
            width: 150px; /* Fixed width for illustration on desktop */
            height: 150px; /* Fixed height for illustration on desktop */
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(167, 217, 224, 0.2); /* æ¹–æ°´è—æ·ºè‰²èƒŒæ™¯ */
            border-radius: 50%; /* åœ“å½¢èƒŒæ™¯ */
        }

        .about-section-block .illustration-wrapper .about-illustration {
            font-size: 5em; /* Larger emoji */
        }

        @media (min-width: 768px) { /* Medium screens and up (desktop) */
            .about-section-block .content-wrapper {
                flex-direction: row; /* Row for desktop */
                text-align: left;
            }
            .about-section-block .text-content {
                padding-right: 30px; /* Add some padding on the right for text */
            }
            .about-section-block .illustration-wrapper {
                width: 200px; /* Larger image on desktop */
                height: 200px;
            }
        }

        /* Thematic Fortune Section Styles */
        /* Removed display: none from here, relying on Tailwind's hidden class */
        .thematic-fortune-section {
            background-color: rgba(245, 245, 220, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(167, 217, 224, 0.4);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-radius: 20px;
            padding: 30px;
            margin-top: 40px;
            max-width: 800px;
            width: 100%;
            flex-direction: column; /* Always flex column for internal layout */
            align-items: center;
            text-align: center;
        }

        .thematic-fortune-tabs {
            display: flex;
            flex-wrap: wrap; /* Allow tabs to wrap on smaller screens */
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            width: 100%;
        }

        .thematic-fortune-tab-button {
            background-color: rgba(196, 193, 217, 0.6); /* éœè¬ç´«æ·ºè‰² */
            color: #333333;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .thematic-fortune-tab-button:hover {
            background-color: #A7D9E0; /* æ¹–æ°´è— */
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(167, 217, 224, 0.4);
        }

        .thematic-fortune-tab-button.active {
            background-color: #A7D9E0; /* æ¹–æ°´è— */
            color: white;
            box-shadow: 0 4px 12px rgba(167, 217, 224, 0.6);
        }

        .thematic-fortune-content {
            display: none; /* Hidden by default */
            width: 100%;
            text-align: left;
            line-height: 1.7;
            color: #6B7280;
            padding: 15px 0;
            white-space: pre-wrap; /* Preserve whitespace and line breaks from LLM */
        }

        .thematic-fortune-content.active {
            display: block;
        }

        .thematic-loading {
            text-align: center;
            color: #A7D9E0;
            margin-top: 20px;
            font-size: 1.1em;
            display: none;
        }

        /* New style for centered intro text */
        .thematic-intro-text {
            text-align: center;
            font-size: 1.1em;
            line-height: 1.7;
            color: #6B7280;
            margin-bottom: 20px; /* Space between text and buttons */
        }
        /* Styles for the new sections within "About" page */
        .about-section-block {
            background-color: rgba(245, 245, 220, 0.8);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(196, 193, 217, 0.3);
            border-radius: 25px;
            padding: 35px;
            margin-bottom: 40px; /* Spacing between blocks */
            max-width: 700px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: left; /* Align text left within these blocks */
            color: #6B7280;
            line-height: 1.8;
            font-size: 1.1em;
        }
        .about-section-block h2 {
            font-size: 1.8em;
            font-weight: 700;
            color: #8A89A6;
            margin-bottom: 15px;
            text-align: center; /* Center section titles */
        }
        .about-section-block ul {
            list-style-type: disc; /* For bullet points */
            margin-left: 20px;
            margin-top: 10px;
        }
        .about-section-block ul li {
            margin-bottom: 8px;
        }
        /* New style for navigation links within about sections */
        .about-section-nav-link {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background-image: linear-gradient(to right, #A7D9E0, #C4C1D9); /* æ¹–æ°´è—åˆ°éœè¬ç´«æ¼¸è®Š */
            color: white;
            border-radius: 10px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 3px 10px rgba(167, 217, 224, 0.4);
        }
        .about-section-nav-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(167, 217, 224, 0.6);
        }

        /* Card display container for side-by-side layout */
        .magic-card-container {
            display: flex; /* ä½¿ç”¨ Flexbox è®“å¡ç‰‡ä¸¦åˆ— */
            justify-content: center; /* å±…ä¸­å°é½Š */
            align-items: center;
            gap: 20px; /* å…©å¼µå¡ç‰‡ä¹‹é–“çš„é–“è· */
            width: auto; /* è®“å…§å®¹æ±ºå®šå¯¬åº¦ */
            height: 350px; /* ç¶­æŒå¡ç‰‡é«˜åº¦ */
            margin: 30px auto;
        }

        .card-display {
            width: 250px; /* å›ºå®šå¯¬åº¦ */
            height: 350px; /* å›ºå®šé«˜åº¦ */
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
            font-size: 1.1em;
            line-height: 1.6;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; /* å¹³æ»‘éæ¸¡æ•ˆæœ */
        }

        .initial-card-back {
            background-image: linear-gradient(to bottom right, #C4C1D9, #A7D9E0); /* éœè¬ç´«åˆ°æ¹–æ°´è—æ¼¸è®Š */
            color: white;
            font-size: 3em;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            /* åˆå§‹ç‹€æ…‹é€æ˜åº¦ç‚º 1ï¼Œè¡¨ç¤ºå¯è¦‹ */
            opacity: 1;
        }

        .initial-card-back::before {
            content: 'âœ¨'; /* Star emoji */
            position: absolute;
            font-size: 4em;
            opacity: 0.3;
            animation: sparkle 3s infinite ease-in-out;
        }

        @keyframes sparkle {
            0% { transform: scale(1) rotate(0deg); opacity: 0.3; }
            50% { transform: scale(1.1) rotate(5deg); opacity: 0.5; }
            100% { transform: scale(1) rotate(0deg); opacity: 0.3; }
        }

        .revealed-card-front {
            background-color: #F5F5DC; /* ç±³æç™½ */
            color: #6B7280; /* æš–ç° */
            border: 2px solid rgba(167, 217, 224, 0.6); /* æ¹–æ°´è—é‚Šæ¡† */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: space-around; /* å‚ç›´åˆ†ä½ˆå…§å®¹ */
            align-items: center;
            opacity: 0; /* åˆå§‹éš±è— */
            transform: translateX(20px); /* åˆå§‹ä½ç½®ç¨å¾®å‘å³åç§»ï¼Œæº–å‚™æ»‘å…¥ */
            pointer-events: none; /* éš±è—æ™‚ä¸éŸ¿æ‡‰äº‹ä»¶ */
        }

        .revealed-card-front.active {
            opacity: 1; /* é¡¯ç¤ºæ™‚å®Œå…¨ä¸é€æ˜ */
            transform: translateX(0); /* æ»‘å…¥åˆ°æœ€çµ‚ä½ç½® */
            pointer-events: auto; /* é¡¯ç¤ºæ™‚éŸ¿æ‡‰äº‹ä»¶ */
        }

        .card-front h3 {
            font-size: 1.5em;
            font-weight: 700;
            color: #8A89A6; /* éœè¬ç´« */
            margin-bottom: 10px;
        }

        .card-front p {
            font-size: 0.95em;
            margin-bottom: 8px;
        }

        .card-front .keywords {
            color: #A7D9E0; /* æ¹–æ°´è— */
            font-weight: 500;
        }

        .card-front .guidance {
            font-style: italic;
            color: #333333;
            margin-top: 10px;
        }

        /* Button container below the card */
        .card-buttons-container {
            display: flex;
            justify-content: center;
            gap: 20px; /* Space between buttons */
            margin-top: 30px; /* Space from the card */
        }

        .draw-card-button, .reset-card-button {
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            white-space: nowrap; /* Prevent text wrapping */
        }

        .draw-card-button {
            background-image: linear-gradient(to right, #FFB6C1, #F0D9D9); /* çŠç‘šç²‰åˆ°æŸ”éœ§ç²‰æ¼¸è®Š */
            color: #333333;
            display: inline-block; /* é è¨­é¡¯ç¤º */
        }
        .draw-card-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 182, 193, 0.6);
        }
        .draw-card-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-image: linear-gradient(to right, #ccc, #bbb);
            box-shadow: none;
        }

        .reset-card-button {
            background-image: linear-gradient(to right, #C4C1D9, #A7D9E0); /* éœè¬ç´«åˆ°æ¹–æ°´è—æ¼¸è®Š */
            color: white;
            display: none; /* é è¨­éš±è— */
        }
        .reset-card-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(196, 193, 217, 0.6);
        }
        .reset-card-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-image: linear-gradient(to right, #ccc, #bbb);
            box-shadow: none;
        }

    </style>
</head>
<body class="flex flex-col items-center min-h-screen">

    <!-- Navbar -->
    <nav class="w-full fixed top-0 left-0 z-50 p-4 flex justify-between items-center px-6">
        <a href="#about" class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-[#8DA3B9] to-[#A7B9C9] drop-shadow-lg cursor-pointer" id="siteLogo">
            å¿ƒéˆæ—…ç¨‹
        </a>

        <!-- Desktop Navigation Links -->
        <div class="hidden md:flex space-x-4 navbar-desktop-links">
            <a href="#about" class="nav-link" data-page="about">é—œæ–¼å¿ƒéˆæ—…ç¨‹ ğŸ’˜</a>
            <a href="#start" class="nav-link" data-page="start">æˆ‘çš„å¿ƒéˆæ—…ç¨‹ ğŸ’</a>
            <a href="#magicStone" class="nav-link" data-page="magicStone">å¿ƒéˆé­”æ³•çŸ³ ğŸ’–</a>
        </div>

        <!-- Hamburger Menu for Mobile -->
        <div class="md:hidden hamburger-menu" id="hamburgerMenu">
            <span></span>
            <span></span>
            <span></span>
        </div>

        <!-- Mobile Navigation Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <a href="#about" class="nav-link" data-page="about">é—œæ–¼å¿ƒéˆæ—…ç¨‹ ğŸ’˜</a>
            <a href="#start" class="nav-link" data-page="start">æˆ‘çš„å¿ƒéˆæ—…ç¨‹ ğŸ’</a>
            <a href="#magicStone" class="nav-link" data-page="magicStone">å¿ƒéˆé­”æ³•çŸ³ ğŸ’–</a>
        </div>
    </nav>

    <!-- Page Content Container -->
    <div id="pageContainer" class="w-full flex flex-col items-center pt-24 pb-8"> <!-- Adjust pt for fixed navbar -->

        <!-- Page 1: é—œæ–¼å¿ƒéˆæ—…ç¨‹ (About) -->
        <div id="aboutPage" class="page-content active">
            <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-[#8DA3B9] to-[#A7B9C9] mb-8 drop-shadow-lg">
                é—œæ–¼å¿ƒéˆæ—…ç¨‹
            </h1>
            <p class="text-center text-xl text-gray-600 mb-10">æ¯æ®µæ—…ç¨‹ï¼Œéƒ½å¾èªè­˜è‡ªå·±é–‹å§‹ã€‚</p>

            <!-- ç¬¬ä¸€å€å¡Šï¼šç¶²ç«™ç¸½é«”ä»‹ç´¹ -->
            <div class="about-section-block">
                <h2 class="text-center">ğŸŒ¿ é—œæ–¼å¿ƒéˆé€™è¶Ÿæ—…ç¨‹</h2>
                <p class="mb-4">åœ¨äººç”Ÿæ¯ä¸€æ®µåœä¸‹è…³æ­¥çš„æ™‚åˆ»ï¼Œä½ æ˜¯å¦ä¹Ÿæ¸´æœ›ï¼Œä¸€å€‹éœéœå‚¾è½ä½ çš„åœ°æ–¹ï¼Ÿ</p>
                <p class="mb-4">ã€Šå¿ƒéˆæ—…ç¨‹ã€‹æ˜¯ä¸€å€‹æº«æŸ”é™ªä¼´çš„å‘½ç†ç¶²ç«™ï¼Œé€éç°¡åŒ–çš„ç´«å¾®æ–—æ•¸èˆ‡ç”Ÿå‘½éˆæ•¸åˆ†æï¼Œå¹«åŠ©ä½ ç†è§£è‡ªå·±çš„å€‹æ€§ç¯€å¥ã€æƒ…æ„Ÿå‹•æ…‹èˆ‡å…§åœ¨åŠ›é‡ã€‚æˆ‘å€‘ç›¸ä¿¡ï¼šç®—å‘½ä¸æ˜¯é è¨€ï¼Œè€Œæ˜¯é€šå¾€è‡ªæˆ‘ç†è§£çš„èµ·é»ã€‚</p>
                <p>ç„¡è«–ä½ æ­£åœ¨å°‹æ‰¾æ–¹å‘ã€èµ°éæ··äº‚ï¼Œæˆ–åªæ˜¯æƒ³æ›´é è¿‘å…§åœ¨çš„è²éŸ³ï¼Œéƒ½å¯ä»¥å¾é€™è£¡ï¼Œé–‹å§‹ä¸€æ®µå±¬æ–¼è‡ªå·±çš„å¿ƒéˆæ—…ç¨‹ã€‚</p>
            </div>

            <!-- ç¬¬äºŒå€å¡Šï¼šã€Œæˆ‘çš„å¿ƒéˆæ—…ç¨‹ã€ä»‹ç´¹ -->
            <div class="about-section-block">
                <h2 class="text-center">ğŸšªã€Œæˆ‘çš„å¿ƒéˆæ—…ç¨‹ã€ä»‹ç´¹</h2>
                <p class="mb-4">æ¯ä¸€æ®µå¿ƒéˆæ—…ç¨‹ï¼Œéƒ½å¾ä¸€å€‹çœŸå¯¦çš„ä½ é–‹å§‹ã€‚</p>
                <p class="mb-4">åœ¨ã€Œæˆ‘çš„å¿ƒéˆæ—…ç¨‹ã€å€åŸŸï¼Œä½ å¯ä»¥ï¼š</p>
                <ul class="list-disc pl-5">
                    <li>âœï¸ è¼¸å…¥ä½ çš„åŸºæœ¬è³‡æ–™ï¼ˆç”Ÿæ—¥ã€å‡ºç”Ÿæ™‚é–“ã€æ€§åˆ¥ï¼‰ï¼Œè®“æˆ‘å€‘ç‚ºä½ ç”Ÿæˆå°ˆå±¬å‘½ç›¤</li>
                    <li>ğŸ”¢ æŸ¥çœ‹ä½ çš„ç”Ÿå‘½éˆæ•¸çµ„åˆï¼Œäº†è§£ä½ å¤©ç”Ÿçš„æ€è€ƒæ–¹å¼èˆ‡èƒ½é‡ç‰¹è³ª</li>
                    <li>ğŸŒ“ é–±è®€ç°¡åŒ–ç‰ˆçš„ç´«å¾®æ–—æ•¸å‘½ç›¤ï¼Œå¾å‘½å®®èˆ‡ä¸»æ˜Ÿçœ‹è¦‹ä½ çš„æ ¸å¿ƒç‹€æ…‹èˆ‡æ½›åœ¨èµ°å‘</li>
                    <li>ğŸ¤ è‹¥ä½ å°å‘½ç›¤å…§å®¹æ„Ÿåˆ°ä¸æ‡‚æˆ–å›°æƒ‘ï¼Œå¯ä»¥é€²ä¸€æ­¥ç”±ä½ çš„å¿ƒéˆé™ªä¼´è€…æ˜Ÿæ˜Ÿæä¾›å€‹äººåŒ–è§£èªªèˆ‡é™ªä¼´</li>
                </ul>
                <p class="mt-4">é€™å€‹ç©ºé–“ï¼Œæ˜¯ä½ èˆ‡è‡ªå·±æ·±åº¦å°è©±çš„èµ·é»ã€‚</p>
                <div class="text-center">
                    <a href="#start" class="about-section-nav-link" data-page="start">å‰å¾€æˆ‘çš„å¿ƒéˆæ—…ç¨‹ ğŸ’</a>
                </div>
            </div>

            <!-- ç¬¬ä¸‰å€å¡Šï¼šã€Œå¿ƒéˆé­”æ³•çŸ³ã€ä»‹ç´¹ -->
            <div class="about-section-block">
                <h2 class="text-center">ğŸ”®ã€Œå¿ƒéˆé­”æ³•çŸ³ã€ä»‹ç´¹</h2>
                <p class="mb-4">ç•¶å‘½ç›¤é‹ªé™³å®Œç•¢ï¼Œä½ å°‡æ”¶åˆ°ä¾†è‡ªå¿ƒéˆçš„é­”æ³•çŸ³å›æ‡‰ã€‚</p>
                <p class="mb-4">ã€Œå¿ƒéˆé­”æ³•çŸ³ã€æ˜¯ä¸€çµ„ä¸»é¡Œå¼çš„å‘½ç†è§£è®€å·¥å…·ï¼Œæ ¹æ“šä½ çš„å‘½ç›¤è‡ªå‹•åˆ†æï¼Œå›æ‡‰ä½ ç•¶ä¸‹æœ€é—œå¿ƒçš„è­°é¡Œï¼ŒåŒ…æ‹¬ï¼š</p>
                <ul class="list-disc pl-5">
                    <li>â¤ï¸ æ„Ÿæƒ…é‹å‹¢ï¼šè¿‘æœŸæƒ…æ„Ÿèƒ½é‡è®ŠåŒ–ã€æ¡ƒèŠ±é‹èˆ‡å…§åœ¨äº’å‹•ç‹€æ…‹</li>
                    <li>ğŸ’¼ äº‹æ¥­ï¼å­¸æ¥­ç™¼å±•ï¼šé©åˆçš„è¡Œå‹•ç¯€å¥ã€å…§åœ¨å‹•åŠ›èˆ‡æ½›åœ¨çªç ´æ–¹å‘</li>
                    <li>ğŸ¡ å®¶åº­é—œä¿‚ï¼šä½ åœ¨å®¶åº­ä¸­çš„è§’è‰²èˆ‡è¿‘æœŸå¯èƒ½çš„æƒ…æ„Ÿèµ·ä¼</li>
                    <li>ğŸŒŸ æ•´é«”é‹å‹¢ï¼šç¶œåˆåˆ†æè¿‘æœŸèƒ½é‡æ³¢å‹•èˆ‡å»ºè­°çš„å¿ƒéˆèª¿æ•´æ–¹å¼</li>
                </ul>
                <p class="mt-4">é»é–‹æ¯ä¸€é¡†é­”æ³•çŸ³ï¼Œå°±æ˜¯ä¸€æ¬¡èˆ‡è‡ªå·±æ›´é è¿‘çš„å°è©±ã€‚</p>
                <div class="text-center">
                    <a href="#magicStone" class="about-section-nav-link" data-page="magicStone">æ¢ç´¢å¿ƒéˆé­”æ³•çŸ³ ğŸ’–</a>
                </div>
            </div>

            <!-- æ–°å¢å€å¡Šï¼šã€Œå¿ƒéˆæ—…ç¨‹çš„è¡Œå›Šã€åŠŸèƒ½å€ -->
            <div class="about-section-block">
                <h2 class="text-center">ğŸ’ å¿ƒéˆé­”æ³•å¡</h2>
                <!-- æ–°å¢çš„èªªæ˜æ–‡å­— -->
                <p class="text-center text-base text-gray-600 mb-4 leading-relaxed">
                    å¦‚æœä½ é‚„æ²’æº–å‚™å¥½è¦é–‹å•Ÿå¿ƒéˆæ—…ç¨‹çš„è©±ï¼Œå¯ä»¥å…ˆå˜—è©¦å¿ƒéˆé­”æ³•å¡ã€‚<br>
                    ä¸éœ€å¡«å¯«è³‡æ–™ï¼Œä¹Ÿä¸ç”¨æƒ³å•é¡Œï¼Œåªè¦éœä¸‹å¿ƒä¾†ï¼ŒæŠ½ä¸€å¼µå¡ï¼Œæ¥æ”¶æ­¤åˆ»å±¬æ–¼ä½ çš„è¨Šæ¯ã€‚<br>
                    æ¯å¼µå¡éƒ½æ˜¯æº«æŸ”çš„æé†’ï¼Œå¸¶ä½ é‡æ–°é€£çµå…§åœ¨ï¼Œæ‰¾åˆ°ä»Šå¤©çš„æ–¹å‘èˆ‡æ”¯æŒã€‚
                </p>
                <p class="mb-6 text-center">æŠ½ä¸€å¼µå¿ƒéˆé­”æ³•å¡ï¼Œè®“ä»Šæ—¥æŒ‡å¼•ç‚ºä½ é»äº®æ–¹å‘ã€‚</p>

                <div class="magic-card-container">
                    <!-- åˆå§‹å¡ç‰‡é¡¯ç¤ºå€ -->
                    <div id="initialCardDisplay" class="card-display initial-card-back">
                        é»æ“Šç¿»ç‰Œ âœ¨
                    </div>
                    <!-- ç¿»é–‹å¾Œå¡ç‰‡å…§å®¹é¡¯ç¤ºå€ -->
                    <div id="revealedCardDisplay" class="card-display revealed-card-front">
                        <h3 id="cardName"></h3>
                        <p class="keywords" id="cardKeywords"></p>
                        <p class="guidance" id="cardGuidance"></p>
                    </div>
                </div>
                <div class="card-buttons-container">
                    <button class="draw-card-button" id="drawCardButton">æŠ½ä¸€å¼µå¡ ğŸƒ</button>
                    <button class="reset-card-button" id="resetCardButton">é‡æ–°æŠ½ç‰Œ ğŸ”„</button>
                </div>
            </div>

        </div>

        <!-- Page 2: æˆ‘çš„å¿ƒéˆæ—…ç¨‹ (Start) -->
        <div id="startPage" class="page-content">
            <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-[#8DA3B9] to-[#A7B9C9] mb-8 drop-shadow-lg">
                æˆ‘çš„å¿ƒéˆæ—…ç¨‹
            </h1>
            <p class="text-center text-xl text-gray-600 mb-10">è«‹å¡«å¯«ä½ çš„å¿ƒéˆå•å·ï¼Œæ¢ç´¢å…§åœ¨å®‡å®™ã€‚</p>

            <div class="w-full max-w-2xl rounded-xl shadow-2xl p-6 md:p-8 mb-10 card">
                <form id="fortuneForm" class="space-y-8">
                    <div class="input-group">
                        <label for="name" class="block text-sm font-medium mb-2">å§“å (å¯é¸)</label>
                        <input type="text" id="name" name="name" placeholder="å¯«ä¸‹ä½ çš„åå­—" class="w-full">
                    </div>

                    <div class="input-group">
                        <label for="birthDate" class="block text-sm font-medium mb-2">å‡ºç”Ÿæ—¥æœŸ (YYYY-MM-DD) <span class="text-red-400">*</span></label>
                        <input type="date" id="birthDate" name="birthDate" required class="w-full">
                    </div>

                    <div class="input-group">
                        <label for="birthTime" class="block text-sm font-medium mb-2">å‡ºç”Ÿæ™‚é–“ (HH:mm) <span class="text-red-400">*</span></label>
                        <input type="time" id="birthTime" name="birthTime" required class="w-full">
                    </div>

                    <div class="input-group">
                        <label for="gender" class="block text-sm font-medium mb-2">æ€§åˆ¥ <span class="text-red-400">*</span></label>
                        <select id="gender" name="gender" required class="w-full">
                            <option value="">è«‹é¸æ“‡</option>
                            <option value="male">ç”·</option>
                            <option value="female">å¥³</option>
                        </select>
                    </div>

                    <button type="submit" class="btn-primary w-full cursor-pointer">
                        é–‹å•Ÿå¿ƒéˆæ—…ç¨‹ ğŸ’Œ
                    </button>
                </form>
            </div>

            <div id="loading-indicator">
                æ­£åœ¨ç‚ºæ‚¨æ•´ç†ä¿¡ä»¶ï¼Œè«‹ç¨å€™...
            </div>

            <div id="results" class="flex flex-col md:flex-row justify-center items-center w-full max-w-5xl mt-10">
                <!-- Numerology Card -->
                <div id="numerologyCard" class="card hidden">
                    <h2 class="result-title">ç”Ÿå‘½éˆæ•¸åˆ†æ</h2>
                    <p class="result-content" id="numerologyResult"></p>
                </div>

                <!-- Zi Wei Dou Shu Card -->
                <div id="ziweiCard" class="card hidden">
                    <h2 class="result-title">ç´«å¾®æ–—æ•¸ç°¡åŒ–æ’ç›¤</h2>
                    <p class="result-content" id="ziweiResult"></p>
                </div>
            </div>

            <!-- Chatbot Section -->
            <div id="chatbotSection" class="chatbot-container hidden">
                <h2 class="result-title mb-4">èˆ‡æ˜Ÿæ˜Ÿå°è©± âœ¨</h2>
                <div id="chatMessages" class="chat-messages">
                    <!-- Chat messages will be appended here -->
                    <!-- Initial message will be set dynamically by JS -->
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chatInput" placeholder="å•å•æ˜Ÿæ˜Ÿï¼Œèªªèªªä½ çš„æƒ³æ³•..." class="w-full">
                    <button id="sendMessageBtn">å•å•æ˜Ÿæ˜Ÿ ğŸª</button>
                </div>
                <div id="chatbotLoading" class="chatbot-loading">
                    æ˜Ÿæ˜Ÿæ­£åœ¨æ€è€ƒä¸­...
                </div>
            </div>

            <button id="resetButton" class="reset-button hidden cursor-pointer">
                å†å¯«ä¸€æ¬¡ä¿¡
            </button>
        </div>

        <!-- Page 3: å¿ƒéˆé­”æ³•çŸ³ (Magic Stone) -->
        <div id="magicStonePage" class="page-content">
            <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-[#8DA3B9] to-[#A7B9C9] mb-8 drop-shadow-lg">
                å¿ƒéˆé­”æ³•çŸ³ âœ¨
            </h1>
            <!-- Intro text for Magic Stone page, always displayed -->
            <p class="thematic-intro-text">
                æ¯é¡†é­”æ³•çŸ³ï¼Œéƒ½æ˜¯ä½ å‘½ç›¤ä¸­çš„ä¸€é¢é¡å­ã€‚<br>
                åœ¨é€™è£¡ï¼Œä½ å°‡çœ‹åˆ°ä¾†è‡ªæ„Ÿæƒ…ã€äº‹æ¥­ã€å®¶åº­èˆ‡é‹å‹¢çš„è¨Šæ¯ï¼Œå®ƒå€‘ä¸æ˜¯å‘½é‹çš„é è¨€ï¼Œè€Œæ˜¯ä½ å…§åœ¨èƒ½é‡çš„å›éŸ³ã€‚<br>
                é»æ“Šæ¯ä¸€å€‹ä¸»é¡Œï¼Œå‚¾è½ä½ éˆé­‚æ­¤åˆ»æœ€æƒ³èªªçš„è©±ã€‚
            </p>

            <!-- Thematic Fortune Section -->
            <div id="thematicFortuneSection" class="thematic-fortune-section">
                <h2 class="result-title mb-6">ä¸»é¡Œé‹å‹¢è§£æ âœ¨</h2>
                <div class="thematic-fortune-tabs">
                    <button class="thematic-fortune-tab-button active" data-theme="love">æ„Ÿæƒ…é‹å‹¢ ğŸ’–</button>
                    <button class="thematic-fortune-tab-button" data-theme="career">äº‹æ¥­ï¼å­¸æ¥­é‹å‹¢ ğŸ’¼</button>
                    <button class="thematic-fortune-tab-button" data-theme="family">å®¶åº­é—œä¿‚ ğŸ¡</button>
                    <button class="thematic-fortune-tab-button" data-theme="overall">ç¶œåˆé‹å‹¢ (é€±ï¼æœˆ) ğŸ—“ï¸</button>
                </div>

                <div id="thematicLoading" class="thematic-loading">
                    æ­£åœ¨ç‚ºæ‚¨è§£æä¸»é¡Œé‹å‹¢...
                </div>

                <!-- Thematic fortune content divs with initial placeholder text -->
                <div id="loveFortuneContent" class="thematic-fortune-content active">
                    <p class="text-center">è«‹å…ˆå›åˆ°ã€Œæˆ‘çš„å¿ƒéˆæ—…ç¨‹ã€é é¢å¡«å¯«æ‚¨çš„å‘½ç›¤è³‡æ–™ï¼Œå³å¯æŸ¥çœ‹ä½ çš„é‹å‹¢ã€‚</p>
                </div>
                <div id="careerFortuneContent" class="thematic-fortune-content">
                    <p class="text-center">è«‹å…ˆå›åˆ°ã€Œæˆ‘çš„å¿ƒéˆæ—…ç¨‹ã€é é¢å¡«å¯«æ‚¨çš„å‘½ç›¤è³‡æ–™ï¼Œå³å¯æŸ¥çœ‹ä½ çš„é‹å‹¢ã€‚</p>
                </div>
                <div id="familyFortuneContent" class="thematic-fortune-content">
                    <p class="text-center">è«‹å…ˆå›åˆ°ã€Œæˆ‘çš„å¿ƒéˆæ—…ç¨‹ã€é é¢å¡«å¯«æ‚¨çš„å‘½ç›¤è³‡æ–™ï¼Œå³å¯æŸ¥çœ‹ä½ çš„é‹å‹¢ã€‚</p>
                </div>
                <div id="overallFortuneContent" class="thematic-fortune-content">
                    <p class="text-center">è«‹å…ˆå›åˆ°ã€Œæˆ‘çš„å¿ƒéˆæ—…ç¨‹ã€é é¢å¡«å¯«æ‚¨çš„å‘½ç›¤è³‡æ–™ï¼Œå³å¯æŸ¥çœ‹ä½ çš„é‹å‹¢ã€‚</p>
                </div>
            </div>
        </div>

    </div>

    <!-- Custom Message Box -->
    <div id="messageBoxOverlay" class="message-box-overlay">
        <div class="message-box">
            <h3 id="messageBoxTitle"></h3>
            <p id="messageBoxContent"></p>
            <button id="messageBoxClose">ç¢ºå®š</button>
        </div>
    </div>

    <script>
        // Store user fortune data globally after calculation
        let userFortuneData = {};
        let thematicFortuneCache = {}; // Cache for thematic fortunes

        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('fortuneForm');
            const numerologyCard = document.getElementById('numerologyCard');
            const ziweiCard = document.getElementById('ziweiCard');
            const numerologyResult = document.getElementById('numerologyResult');
            const ziweiResult = document.getElementById('ziweiResult');
            const loadingIndicator = document.getElementById('loading-indicator');
            const resetButton = document.getElementById('resetButton');
            const resultsSection = document.getElementById('results');
            const chatbotSection = document.getElementById('chatbotSection');
            const chatMessagesDiv = document.getElementById('chatMessages');
            const chatInput = document.getElementById('chatInput');
            const sendMessageBtn = document.getElementById('sendMessageBtn');
            const chatbotLoading = document.getElementById('chatbotLoading');
            const nameInput = document.getElementById('name'); // Get the name input field

            const thematicFortuneSection = document.getElementById('thematicFortuneSection');
            const thematicFortuneTabButtons = document.querySelectorAll('.thematic-fortune-tab-button');
            const thematicFortuneContents = document.querySelectorAll('.thematic-fortune-content');
            const thematicLoading = document.getElementById('thematicLoading');
            // Thematic intro text is now a static part of the HTML, no need to get it via JS for display toggling.

            const messageBoxOverlay = document.getElementById('messageBoxOverlay');
            const messageBoxTitle = document.getElementById('messageBoxTitle');
            const messageBoxContent = document.getElementById('messageBoxContent');
            const messageBoxClose = document.getElementById('messageBoxClose');

            // --- Card Logic for "å¿ƒéˆæ—…ç¨‹çš„è¡Œå›Š" ---
            const initialCardDisplay = document.getElementById('initialCardDisplay');
            const revealedCardDisplay = document.getElementById('revealedCardDisplay');
            const drawCardButton = document.getElementById('drawCardButton');
            const resetCardButton = document.getElementById('resetCardButton');
            const cardName = document.getElementById('cardName');
            const cardKeywords = document.getElementById('cardKeywords');
            const cardGuidance = document.getElementById('cardGuidance');

            const magicCardsData = [
                { name: "è¦ºå¯Ÿ", keywords: "éœå¿ƒã€æ³¨æ„ç´°ç¯€ã€å…§åœ¨è§€ç…§", guidance: "åœä¸‹ä¾†è§€å¯Ÿï¼Œä¸æ€¥è‘—å›æ‡‰ï¼Œä½ æœƒæ›´æ‡‚å¾—è‡ªå·±ã€‚" },
                { name: "ä¿¡ä»»", keywords: "æ”¾ä¸‹æ§åˆ¶ã€èˆ‡å®‡å®™åˆä½œ", guidance: "ä½ ä¸éœ€è¦çŸ¥é“æ‰€æœ‰ç­”æ¡ˆï¼Œè®“æœªçŸ¥ä¹Ÿæˆç‚ºæ—…ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚" },
                { name: "è¡Œå‹•", keywords: "ä¸»å‹•å‡ºæ“Šã€å¯¦è¸æƒ³æ³•", guidance: "å“ªæ€•åªæ˜¯å°å°çš„ä¸€æ­¥ï¼Œä¹Ÿæ¯”åœåœ¨åŸåœ°æ›´é è¿‘æœªä¾†çš„ä½ ã€‚" },
                { name: "å‹‡æ°£", keywords: "çªç ´ææ‡¼ã€çœŸå¯¦é¢å°", guidance: "ä½ ä¸æ˜¯ä¸å®³æ€•ï¼Œè€Œæ˜¯é¡˜æ„å¸¶è‘—ææ‡¼å‰é€²ï¼Œé€™å°±æ˜¯å‹‡æ•¢ã€‚" },
                { name: "ç™‚ç™’", keywords: "é‡‹æ”¾ã€å…§åœ¨ä¿®å¾©ã€è‡ªæˆ‘ç…§é¡§", guidance: "ä»Šå¤©è«‹å°è‡ªå·±æº«æŸ”ä¸€é»ï¼Œä½ å·²ç¶“åšå¾—å¾ˆå¥½äº†ã€‚" },
                { name: "æ”¾ä¸‹", keywords: "æ–·æ¨é›¢ã€çµæŸã€é‡‹æ‡·", guidance: "æœ‰äº›é‡é‡ï¼Œæ˜¯ä½ å¯ä»¥é¸æ“‡ä¸å†èƒŒè² çš„ã€‚" },
                { name: "è½‰åŒ–", keywords: "é‡å¡‘ã€è®ŠåŒ–ä¸­çš„ç¥ç¦", guidance: "æ··äº‚ä¸æ˜¯çµ‚é»ï¼Œè€Œæ˜¯è›»è®Šçš„é–‹ç«¯ã€‚" },
                { name: "æ„›", keywords: "æº«æŸ”ã€åŒ…å®¹ã€æ„›è‡ªå·±", guidance: "å°‡æ„›ç‘å‘ä½ åœ¨ä¹çš„äººï¼Œä¹Ÿåˆ¥å¿˜äº†ç•™ä¸€é»çµ¦è‡ªå·±ã€‚" },
                { name: "è€å¿ƒ", keywords: "ç­‰å¾…æ™‚æ©Ÿã€ç©©å®šå¿ƒå¿µ", guidance: "ä¸è‘—æ€¥ï¼Œé‡è¦çš„äº‹æƒ…æ­£åœ¨é»˜é»˜æˆå½¢ä¸­ã€‚" },
                { name: "é€£çµ", keywords: "äººéš›é—œä¿‚ã€æ•é–‹å¿ƒæˆ¿", guidance: "ä½ ä¸å¿…ç¨è‡ªæ‰¿å—ï¼Œè®“é€£çµæˆç‚ºä½ çš„åŠ›é‡ã€‚" },
                { name: "æ¥ç´", keywords: "å…è¨±çœŸå¯¦ã€æ“æŠ±ä¸å®Œç¾", guidance: "ä¸æ˜¯æ”¹è®Šè‡ªå·±æ‰å€¼å¾—è¢«æ„›ï¼Œè€Œæ˜¯ä½ æœ¬ä¾†å°±å¤ å¥½ã€‚" },
                { name: "æ¸…ç†", keywords: "é‡æ¸…é›œè¨Šã€æƒ…ç·’é‡‹æ”¾", guidance: "ä»Šå¤©å¾ˆé©åˆæ‰“æƒï¼Œä¸åªç©ºé–“ï¼Œé‚„æœ‰ä½ çš„å…§å¿ƒã€‚" },
                { name: "ç•Œç·š", keywords: "ä¿è­·è‡ªå·±ã€èªªä¸çš„å‹‡æ°£", guidance: "æº«æŸ”ä¸æ˜¯ç„¡é™åŒ…å®¹ï¼Œè«‹è¨˜å¾—å®ˆä½è‡ªå·±çš„å…‰ã€‚" },
                { name: "ç›´è¦º", keywords: "å…§åœ¨è²éŸ³ã€éˆæ„ŸæŒ‡å¼•", guidance: "ç›¸ä¿¡é‚£å€‹æ²’ä¾†ç”±å»ä¸€å†æµ®ç¾çš„æ„Ÿè¦ºï¼Œå®ƒçŸ¥é“ä½ è©²å¾€å“ªè£¡èµ°ã€‚" },
                { name: "ç¥ç¦", keywords: "èƒ½é‡æµå‹•ã€å¿ƒå¿µæ“´å±•", guidance: "ä»Šå¤©çš„ä½ ä¹Ÿå¯ä»¥æˆç‚ºåˆ¥äººçš„å…‰ï¼Œå‚³éä¸€é»ç¥ç¦å§ã€‚" },
                { name: "æ„Ÿè¬", keywords: "è±ç››æ„è­˜ã€ç”Ÿæ´»çš„ç¦®ç‰©", guidance: "æ³¨æ„é‚£äº›å¾®å°å»æº«æŸ”çš„å¥½äº‹ï¼Œå®ƒå€‘æ­£åœ¨æ”¯æŒä½ ã€‚" },
                { name: "èª å¯¦", keywords: "çœŸå¯¦é¢å°ã€èˆ‡è‡ªå·±å°è©±", guidance: "ä¸éœ€è¦å½è£ï¼Œä½ çš„çœŸå¿ƒå€¼å¾—è¢«çœ‹è¦‹ã€‚" },
                { name: "å¯èƒ½", keywords: "é¸æ“‡æ¬Šã€æœªä¾†çš„æ‰“é–‹", guidance: "è«‹è¨˜ä½ï¼Œä»Šå¤©ä¸ç­‰æ–¼æ°¸é ï¼Œä¸€åˆ‡éƒ½é‚„æœ‰å¯èƒ½ã€‚" }
            ];

            function drawMagicCard() {
                // å¦‚æœå·²ç¶“é¡¯ç¤ºå…§å®¹å¡ç‰‡ï¼Œå‰‡å…ˆé‡ç½®
                if (revealedCardDisplay.classList.contains('active')) {
                    resetMagicCard();
                    setTimeout(() => {
                        performDrawLogic();
                    }, 500); // å»¶é²ä»¥ç­‰å¾…é‡ç½®å‹•ç•«å®Œæˆ
                } else {
                    performDrawLogic();
                }
            }

            function performDrawLogic() {
                const randomIndex = Math.floor(Math.random() * magicCardsData.length);
                const selected = magicCardsData[randomIndex];

                cardName.textContent = selected.name;
                cardKeywords.textContent = `ğŸ”‘ é—œéµèªï¼š${selected.keywords}`;
                cardGuidance.textContent = `âœ¨ ä»Šæ—¥æŒ‡å¼•ï¼š${selected.guidance}`;

                // è®“åˆå§‹å¡ç‰‡è®Šæš—ï¼Œä¸¦ç§»é™¤é»æ“Šäº‹ä»¶
                initialCardDisplay.style.opacity = '0.5';
                initialCardDisplay.style.cursor = 'default';
                initialCardDisplay.removeEventListener('click', drawMagicCard); // ç§»é™¤äº‹ä»¶ç›£è½å™¨

                // é¡¯ç¤ºå…§å®¹å¡ç‰‡ä¸¦è§¸ç™¼å‹•ç•«
                revealedCardDisplay.classList.remove('hidden');
                void revealedCardDisplay.offsetWidth; // å¼·åˆ¶é‡ç¹ªä»¥ç¢ºä¿å‹•ç•«è§¸ç™¼
                revealedCardDisplay.classList.add('active');

                // éš±è—ã€ŒæŠ½ä¸€å¼µå¡ã€æŒ‰éˆ•ï¼Œé¡¯ç¤ºã€Œé‡æ–°æŠ½ç‰Œã€æŒ‰éˆ•
                drawCardButton.style.display = 'none';
                resetCardButton.style.display = 'inline-block';
            }

            function resetMagicCard() {
                // éš±è—å…§å®¹å¡ç‰‡ä¸¦è§¸ç™¼å‹•ç•«
                revealedCardDisplay.classList.remove('active');
                revealedCardDisplay.classList.add('hidden'); // ç¢ºä¿åœ¨å‹•ç•«çµæŸå¾Œéš±è—

                // é‡ç½®åˆå§‹å¡ç‰‡ç‹€æ…‹
                initialCardDisplay.style.opacity = '1';
                initialCardDisplay.style.cursor = 'pointer';
                initialCardDisplay.addEventListener('click', drawMagicCard); // é‡æ–°æ·»åŠ äº‹ä»¶ç›£è½å™¨

                // é¡¯ç¤ºã€ŒæŠ½ä¸€å¼µå¡ã€æŒ‰éˆ•ï¼Œéš±è—ã€Œé‡æ–°æŠ½ç‰Œã€æŒ‰éˆ•
                drawCardButton.style.display = 'inline-block';
                resetCardButton.style.display = 'none';

                // åœ¨å‹•ç•«å®Œæˆå¾Œæ¸…é™¤å…§å®¹
                setTimeout(() => {
                    cardName.textContent = '';
                    cardKeywords.textContent = '';
                    cardGuidance.textContent = '';
                }, 500); // é…åˆ revealedCardDisplay çš„ transition duration
            }

            // ç¶å®šæŒ‰éˆ•å’Œå¡ç‰‡é»æ“Šäº‹ä»¶
            drawCardButton.addEventListener('click', drawMagicCard);
            resetCardButton.addEventListener('click', resetMagicCard);
            initialCardDisplay.addEventListener('click', drawMagicCard);


            // --- Page Navigation Logic ---
            const aboutPage = document.getElementById('aboutPage');
            const startPage = document.getElementById('startPage');
            const magicStonePage = document.getElementById('magicStonePage'); // New page element
            const navLinks = document.querySelectorAll('.nav-link');
            const siteLogo = document.getElementById('siteLogo');
            const hamburgerMenu = document.getElementById('hamburgerMenu');
            const mobileMenu = document.getElementById('mobileMenu');
            const aboutSectionNavLinks = document.querySelectorAll('.about-section-nav-link'); // Select new links

            // Add event listeners for the new about section navigation links
            aboutSectionNavLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = link.dataset.page;
                    history.pushState(null, '', `#${pageId}`); // Update URL hash
                    showPage(pageId);
                });
            });


            function showPage(pageId) {
                console.log(`åˆ‡æ›é é¢è‡³: ${pageId}`); // Debug log
                // Hide all pages
                document.querySelectorAll('.page-content').forEach(page => {
                    page.classList.remove('active');
                    page.style.display = 'none'; // Ensure it's hidden
                });
                // Show the target page
                const targetPage = document.getElementById(pageId + 'Page');
                if (targetPage) {
                    targetPage.classList.add('active');
                    targetPage.style.display = 'flex'; // Use flex for page content
                    console.log(`é é¢ ${pageId} å·²é¡¯ç¤ºã€‚`); // Debug log

                    // Special handling for magicStonePage to ensure thematic section is visible
                    if (pageId === 'magicStone') {
                        thematicFortuneSection.style.display = 'flex'; // Explicitly show thematic section
                        // Manage buttons and content visibility based on userFortuneData
                        if (Object.keys(userFortuneData).length === 0) { // Check if userFortuneData is empty
                            thematicFortuneTabButtons.forEach(btn => btn.style.display = 'none'); // Hide buttons
                            thematicFortuneContents.forEach(contentDiv => {
                                // Reset content to placeholder and hide all content divs initially
                                contentDiv.innerHTML = '<p class="text-center">è«‹å…ˆå›åˆ°ã€Œæˆ‘çš„å¿ƒéˆæ—…ç¨‹ã€é é¢å¡«å¯«æ‚¨çš„å‘½ç›¤è³‡æ–™ï¼Œå³å¯æŸ¥çœ‹ä½ çš„é‹å‹¢ã€‚</p>'; // Ensure placeholder is centered
                                contentDiv.style.display = 'none';
                            });
                            // Show only the first content div with its placeholder
                            document.getElementById('loveFortuneContent').style.display = 'block';
                            document.getElementById('loveFortuneContent').classList.add('active'); // Ensure first tab is active
                            thematicFortuneTabButtons[0].classList.add('active'); // Ensure first button is active
                        } else {
                            thematicFortuneTabButtons.forEach(btn => btn.style.display = 'block'); // Show buttons
                            // Re-trigger the active tab to load its content (from cache or API)
                            const currentActiveTab = document.querySelector('.thematic-fortune-tab-button.active');
                            if (currentActiveTab) {
                                showThematicFortune(currentActiveTab.dataset.theme);
                            } else {
                                showThematicFortune('love'); // Default to love if no active tab
                            }
                        }
                        console.log("å¿ƒéˆé­”æ³•çŸ³é é¢é¡¯ç¤ºæ™‚ï¼Œä¸»é¡Œé‹å‹¢å€å¡Šä¹Ÿå·²é¡¯ç¤ºã€‚");
                    } else {
                        thematicFortuneSection.style.display = 'none'; // Hide if not magicStonePage
                    }

                } else {
                    console.warn(`æ‰¾ä¸åˆ° ID ç‚º ${pageId}Page çš„é é¢ã€‚`); // Debug log
                }

                // Update active link in navbar
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.page === pageId) {
                        link.classList.add('active');
                    }
                });

                // Close mobile menu if open
                hamburgerMenu.classList.remove('open');
                mobileMenu.style.display = 'none';

                // Scroll to top of the new page content
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            // Handle navigation clicks
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = link.dataset.page;
                    history.pushState(null, '', `#${pageId}`); // Update URL hash
                    showPage(pageId);
                });
            });

            // Handle logo click (default to about page)
            siteLogo.addEventListener('click', (e) => {
                e.preventDefault();
                history.pushState(null, '', '#about');
                showPage('about');
            });

            // Handle hamburger menu click
            hamburgerMenu.addEventListener('click', () => {
                hamburgerMenu.classList.toggle('open');
                if (mobileMenu.style.display === 'flex') {
                    mobileMenu.style.display = 'none';
                } else {
                    mobileMenu.style.display = 'flex';
                }
            });

            // Listen for hash changes (back/forward browser buttons)
            window.addEventListener('hashchange', () => {
                const pageId = window.location.hash.substring(1) || 'about';
                showPage(pageId);
            });

            // Initial page load based on URL hash or default to 'about'
            const initialPageId = window.location.hash.substring(1) || 'about';
            showPage(initialPageId);


            // Function to show custom message box
            function showMessageBox(title, message) {
                messageBoxTitle.textContent = title;
                messageBoxContent.textContent = message;
                messageBoxOverlay.style.display = 'flex';
            }

            // Close message box
            messageBoxClose.addEventListener('click', () => {
                messageBoxOverlay.style.display = 'none';
            });

            // Function to generate the initial greeting message
            function generateInitialGreeting(userName) {
                let greeting = "ä½ å¥½å‘€";
                if (userName) {
                    greeting += `ï¼Œ${userName}`;
                }
                greeting += "ï¼Œå¾ˆé«˜èˆˆèªè­˜ä½ ï¼Œæˆ‘æ˜¯ä½ çš„é™ªä¼´å‹æ©Ÿå™¨äººâœ¨æ˜Ÿæ˜Ÿã€‚æœ€è¿‘éå¾—å¥½å—ï¼Ÿç„¡è«–æ˜¯ç™¼ç”Ÿå¿«æ¨‚æˆ–æ˜¯æ‚²å‚·çš„äº‹æƒ…éƒ½å¯ä»¥è·Ÿæˆ‘åˆ†äº«ï¼Œæˆ‘æœƒçµ¦ä½ ä¸€äº›å»ºè­°ï¼Œè«‹ä¸è¦å¿˜è¨˜ã€Œä½ ä¸æ˜¯ä¸€å€‹äººã€ï¼Œæˆ‘æœƒé™ªè‘—ä½ ä¸€èµ·åº¦éã€‚";
                return greeting;
            }

            // Initialize chat messages when the page loads (or when chatbot is shown for the first time)
            function initializeChatbotGreeting() {
                const userName = nameInput.value.trim();
                const initialGreeting = generateInitialGreeting(userName);
                chatMessagesDiv.innerHTML = `<div class="bot-message message-bubble">${initialGreeting}</div>`;
            }

            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const birthDateStr = document.getElementById('birthDate').value;
                const birthTimeStr = document.getElementById('birthTime').value;
                const gender = document.getElementById('gender').value;
                const name = nameInput.value.trim(); // Get name here for use in greeting

                if (!birthDateStr || !birthTimeStr || !gender) {
                    showMessageBox('è³‡æ–™ä¸å®Œæ•´', 'è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ (å‡ºç”Ÿæ—¥æœŸã€å‡ºç”Ÿæ™‚é–“ã€æ€§åˆ¥)ã€‚');
                    return;
                }

                loadingIndicator.style.display = 'block';
                numerologyCard.classList.add('hidden');
                ziweiCard.classList.add('hidden');
                resetButton.classList.add('hidden'); // Hide reset button during calculation
                chatbotSection.classList.add('hidden'); // Hide chatbot during new calculation

                try {
                    // --- ç”Ÿå‘½éˆæ•¸è¨ˆç®— ---
                    const [year, month, day] = birthDateStr.split('-').map(Number);
                    const lifePathNumber = calculateLifePathNumber(year, month, day);
                    const numerologyDescription = getNumerologyDescription(lifePathNumber);
                    numerologyResult.innerHTML = `
                        <p class="mb-2">ä½ çš„ä¸»å‘½æ•¸æ˜¯ï¼š<span class="text-[#FFB6C1] text-2xl font-bold">${lifePathNumber}</span></p>
                        <p>${numerologyDescription}</p>
                    `;
                    numerologyCard.classList.remove('hidden');

                    // --- ç´«å¾®æ–—æ•¸ç°¡åŒ–æ’ç›¤ ---
                    const [hour, minute] = birthTimeStr.split(':').map(Number);
                    const ziweiAnalysis = getSimplifiedZiweiAnalysis(year, month, day, hour, gender);
                    ziweiResult.innerHTML = `
                        <p class="mb-2">ä½ çš„å‘½å®®ï¼š<span class="text-[#FFB6C1] text-xl font-bold">${ziweiAnalysis.lifePalace}</span></p>
                        <p class="mb-2">ä½ çš„ä¸»æ˜Ÿï¼š<span class="text-[#FFB6C1] text-xl font-bold">${ziweiAnalysis.mainStar}</span></p>
                        <p>${ziweiAnalysis.description}</p>
                    `;
                    ziweiCard.classList.remove('hidden');

                    // Store fortune data for chatbot and thematic fortunes
                    userFortuneData = {
                        name: name,
                        birthDate: birthDateStr,
                        birthTime: birthTimeStr,
                        gender: gender,
                        lifepath_number: lifePathNumber,
                        lifepath_description: numerologyDescription,
                        ziwei_main_star: ziweiAnalysis.mainStar,
                        ziwei_minggong: ziweiAnalysis.lifePalace,
                        ziwei_description: ziweiAnalysis.description
                    };

                    thematicFortuneCache = {}; // Clear thematic fortune cache on new calculation

                    resetButton.classList.remove('hidden'); // Show reset button after results
                    chatbotSection.classList.remove('hidden'); // Show chatbot after results

                    console.log("å‘½ç›¤è³‡æ–™å·²è¨ˆç®—ä¸¦å„²å­˜:", userFortuneData); // Debug log

                    // Set initial greeting for chatbot after results are displayed
                    initializeChatbotGreeting();
                    chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight; // Scroll initial message into view

                    // Removed the automatic page navigation to 'magicStone'
                    // showPage('magicStone'); // This line is removed
                    console.log("å·²å®Œæˆå‘½ç›¤è¨ˆç®—ï¼Œåœç•™åœ¨æˆ‘çš„å¿ƒéˆæ—…ç¨‹é é¢ã€‚"); // Debug log

                } catch (error) {
                    console.error("å åœè¨ˆç®—å‡ºéŒ¯:", error);
                    showMessageBox('è¨ˆç®—éŒ¯èª¤', 'åœ¨åˆ†æä½ çš„å‘½ç›¤æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
                } finally {
                    loadingIndicator.style.display = 'none';
                }
            });

            // Reset button functionality
            resetButton.addEventListener('click', () => {
                form.reset(); // Clear form fields
                numerologyCard.classList.add('hidden');
                ziweiCard.classList.add('hidden');
                resetButton.classList.add('hidden');
                chatbotSection.classList.add('hidden'); // Hide chatbot on reset
                thematicFortuneSection.style.display = 'none'; // Hide thematic fortune section on reset (on magicStonePage)

                // Reset thematic fortune content on magicStonePage
                thematicFortuneContents.forEach(contentDiv => {
                    contentDiv.innerHTML = '<p class="text-center">è«‹å…ˆå›åˆ°ã€Œæˆ‘çš„å¿ƒéˆæ—…ç¨‹ã€é é¢å¡«å¯«æ‚¨çš„å‘½ç›¤è³‡æ–™ï¼Œå³å¯æŸ¥çœ‹ä½ çš„é‹å‹¢ã€‚</p>'; // Reset content to placeholder and center it
                    contentDiv.classList.remove('active'); // Ensure all content is hidden
                    contentDiv.style.display = 'none'; // Ensure it's hidden
                });
                thematicFortuneTabButtons.forEach(button => {
                    button.classList.remove('active');
                    button.style.display = 'none'; // Hide buttons on reset
                });
                // Show the first tab content with placeholder and activate its button
                document.getElementById('loveFortuneContent').classList.add('active');
                document.getElementById('loveFortuneContent').style.display = 'block';
                thematicFortuneTabButtons[0].classList.add('active');


                initializeChatbotGreeting(); // Reset chat messages with initial greeting
                userFortuneData = {}; // Clear fortune data
                thematicFortuneCache = {}; // Clear thematic fortune cache
                showPage('start'); // Go back to the start page after reset
                console.log("ç¶²ç«™å·²é‡ç½®ä¸¦å›åˆ°æˆ‘çš„å¿ƒéˆæ—…ç¨‹é é¢ã€‚"); // Debug log
            });

            // --- Thematic Fortune Logic ---
            thematicFortuneTabButtons.forEach(button => {
                button.addEventListener('click', async () => {
                    const theme = button.dataset.theme;
                    console.log(`é»æ“Šä¸»é¡Œå åœæŒ‰éˆ•: ${theme}`); // Debug log
                    await showThematicFortune(theme);
                });
            });

            async function showThematicFortune(theme) {
                // Deactivate all tab buttons and content areas
                thematicFortuneTabButtons.forEach(btn => btn.classList.remove('active'));
                thematicFortuneContents.forEach(contentDiv => {
                    contentDiv.classList.remove('active');
                    contentDiv.style.display = 'none'; // Ensure all are hidden
                });

                // Activate the clicked tab button and its corresponding content area
                const activeTabButton = document.querySelector(`.thematic-fortune-tab-button[data-theme="${theme}"]`);
                const activeContentDiv = document.getElementById(`${theme}FortuneContent`);

                if (activeTabButton) activeTabButton.classList.add('active');
                if (activeContentDiv) {
                    activeContentDiv.classList.add('active');
                    activeContentDiv.style.display = 'block'; // Show the active content div
                }
                console.log(`ä¸»é¡Œ ${theme} çš„æŒ‰éˆ•å’Œå…§å®¹å·²è¨­å®šç‚ºæ´»èºç‹€æ…‹ã€‚`); // Debug log

                // Check if fortune data is available
                if (Object.keys(userFortuneData).length === 0) { // Check if userFortuneData is empty
                    // If no data, ensure content is placeholder and buttons are hidden
                    thematicFortuneTabButtons.forEach(btn => btn.style.display = 'none');
                    activeContentDiv.innerHTML = '<p class="text-center">è«‹å…ˆå›åˆ°ã€Œæˆ‘çš„å¿ƒéˆæ—…ç¨‹ã€é é¢å¡«å¯«æ‚¨çš„å‘½ç›¤è³‡æ–™ï¼Œå³å¯æŸ¥çœ‹ä½ çš„é‹å‹¢ã€‚</p>'; // Ensure placeholder is centered
                    console.warn("ç¼ºå°‘å‘½ç›¤è³‡æ–™ï¼Œç„¡æ³•ç”Ÿæˆä¸»é¡Œé‹å‹¢ã€‚"); // Debug log
                    return;
                } else {
                    // If data exists, ensure buttons are visible (handled by showPage or here)
                    thematicFortuneTabButtons.forEach(btn => btn.style.display = 'block');
                }


                // Check cache first
                if (thematicFortuneCache[theme]) {
                    activeContentDiv.innerHTML = thematicFortuneCache[theme];
                    console.log(`ä¸»é¡Œ ${theme} çš„å…§å®¹å·²å¾å¿«å–è¼‰å…¥ã€‚`); // Debug log
                    return;
                }

                thematicLoading.style.display = 'block'; // Show thematic loading indicator
                activeContentDiv.innerHTML = ''; // Clear previous content
                console.log(`æ­£åœ¨ç‚ºä¸»é¡Œ ${theme} è«‹æ±‚ AI è§£æ...`); // Debug log

                let prompt = `
                ä½ æ˜¯ä¸€å€‹æº«æŸ”ã€å®‰éœã€é™ªä¼´å¼çš„å‘½ç† Chatbotï¼Œä½ çš„åå­—æ˜¯ã€Œæ˜Ÿæ˜Ÿã€ã€‚å“ç‰Œåç¨±æ˜¯ã€Œå¿ƒéˆæ—…ç¨‹ã€ã€‚
                ä½ çš„ä»»å‹™æ˜¯æ ¹æ“šä½¿ç”¨è€…çš„å‘½æ ¼ç‰¹è³ªï¼Œæä¾›å€‹äººåŒ–å»ºè­°èˆ‡è§£æã€‚
                å›ç­”å…§å®¹éœ€æ ¹æ“šå‘½æ ¼ç‰¹è³ªèª¿æ•´ï¼Œé¿å…æ³›æ³›è€Œè«‡ã€‚
                **è«‹åœ¨å›ç­”ä¸­å¼·èª¿ä½¿ç”¨è€…çš„ç”Ÿå‘½éˆæ•¸ä¸»å‘½æ•¸ã€ç´«å¾®æ–—æ•¸ä¸»æ˜Ÿå’Œå‘½å®®æ‰€ä»£è¡¨çš„ç‰¹è³ªï¼Œä½†ä¸è¦ç›´æ¥æåŠã€Œç”Ÿå‘½éˆæ•¸ä¸»å‘½æ•¸ã€ã€ã€Œç´«å¾®æ–—æ•¸ä¸»æ˜Ÿã€ã€ã€Œç´«å¾®æ–—æ•¸å‘½å®®ã€ç­‰è¡“èªï¼Œè€Œæ˜¯å°‡é€™äº›ç‰¹è³ªè‡ªç„¶åœ°èå…¥å»ºè­°ä¸­ã€‚**
                å›ç­”èªæ°£ä¿æŒæº«æŸ”ã€é™ªä¼´ã€æœ‰å•Ÿç™¼æ€§ï¼Œä¸èª‡å¼µä¸ç¥ç§˜ã€‚
                å›ç­”é•·åº¦é©ä¸­ï¼Œèƒ½è®“ä½¿ç”¨è€…æ„Ÿè¦ºåƒåœ¨èˆ‡ä¸€ä½çŸ¥å¿ƒæœ‹å‹èŠå¤©ã€‚
                é¿å…å‘½é‹çµ•å°è«–ï¼Œå¼·èª¿ã€Œå»ºè­°ã€èˆ‡ã€Œé™ªä¼´ã€çš„æ…‹åº¦ã€‚
                è«‹åœ¨å›ç­”ä¸­å¤šä½¿ç”¨ä¸€äº›æº«æš–ã€å‹å–„çš„emojiï¼Œä¾‹å¦‚ï¼šâœ¨ğŸŒ¸ğŸ’–ğŸŒŸğŸ˜ŠğŸ’¡ğŸŒ±ã€‚
                **è«‹å°‡å›ç­”åˆ†æ®µï¼Œä½¿ç”¨ç©ºè¡Œéš”é–‹ï¼Œè®“å…§å®¹æ›´èˆ’æœã€å¥½é–±è®€ï¼Œé¿å…ä½¿ç”¨ç¬¦è™Ÿï¼ˆå¦‚ '*'ï¼‰ä¾†åˆ†æ®µã€‚**
                **å¦‚æœéœ€è¦åˆ—é»ï¼Œè«‹ä½¿ç”¨ Markdown çš„åˆ—é»ç¬¦è™Ÿï¼ˆä¾‹å¦‚ï¼š'- é …ç›®' æˆ– '* é …ç›®'ï¼‰ï¼Œä¸¦ç¢ºä¿æ¯å€‹åˆ—é»ä¹‹é–“æœ‰ç©ºè¡Œã€‚**
                **æ¯å‰‡å»ºè­°è«‹æ§åˆ¶åœ¨ 100-150 å­—ä¹‹é–“ã€‚**

                ä»¥ä¸‹æ˜¯ä½¿ç”¨è€…çš„å‘½æ ¼è³‡æ–™ï¼š
                å§“å: ${userFortuneData.name || 'æœªæä¾›'}
                å‡ºç”Ÿæ—¥æœŸ: ${userFortuneData.birthDate}
                å‡ºç”Ÿæ™‚é–“: ${userFortuneData.birthTime}
                æ€§åˆ¥: ${userFortuneData.gender === 'male' ? 'ç”·' : 'å¥³'}
                ç”Ÿå‘½éˆæ•¸ä¸»å‘½æ•¸: ${userFortuneData.lifepath_number} - ${userFortuneData.lifepath_description}
                ç´«å¾®æ–—æ•¸ä¸»æ˜Ÿ: ${userFortuneData.ziwei_main_star}
                ç´«å¾®æ–—æ•¸å‘½å®®: ${userFortuneData.ziwei_minggong}
                ç´«å¾®æ–—æ•¸ç°¡ä»‹: ${userFortuneData.ziwei_description}
                `;

                const currentDate = new Date();
                const currentYear = currentDate.getFullYear();
                const currentMonth = currentDate.getMonth() + 1; // Month is 0-indexed
                const currentDay = currentDate.getDate();
                const currentWeekDay = currentDate.getDay(); // 0 for Sunday, 1 for Monday, etc.

                switch (theme) {
                    case 'love':
                        prompt += `\nç¾åœ¨è«‹é‡å°ä½¿ç”¨è€…çš„ã€Œæ„Ÿæƒ…é‹å‹¢ã€æä¾›ç°¡çŸ­åˆ†æå’Œæç¤ºèªã€‚\nåˆ†æå…§å®¹å¯åŒ…å«ï¼šæ¡ƒèŠ±é‹æŒ‡æ•¸ã€è¿‘æœŸå¸å¼•åŠ›ç‰¹è³ªã€æƒ…æ„Ÿæ¨¡å¼æé†’ã€‚è«‹ç‰¹åˆ¥çµåˆä½¿ç”¨è€…çš„ç”Ÿå‘½éˆæ•¸ä¸»å‘½æ•¸ï¼ˆç‰¹åˆ¥æ˜¯2ã€6ã€7è™Ÿäººï¼‰ã€ç´«å¾®æ–—æ•¸ä¸­çš„å¤«å¦»å®®ä¸»æ˜Ÿèˆ‡æµå¹´ä½œç”¨ä¾†æä¾›å»ºè­°ã€‚è«‹åœ¨é–‹é ­åŒ…å«ä¸€å€‹ç°¡å–®çš„æ¡ƒèŠ±é‹æŒ‡æ•¸ï¼Œä¾‹å¦‚ï¼šã€Œæ¡ƒèŠ±é‹æŒ‡æ•¸ï¼šâ˜…â˜…â˜…â˜†â˜†ã€ã€‚`;
                        break;
                    case 'career':
                        const userAge = currentYear - new Date(userFortuneData.birthDate).getFullYear();
                        if (userAge < 25) { // Simplified age check for student vs professional
                            prompt += `\nç¾åœ¨è«‹é‡å°ä½¿ç”¨è€…çš„ã€Œå­¸æ¥­é‹å‹¢ã€æä¾›ç°¡çŸ­åˆ†æå’Œæç¤ºèªã€‚\nåˆ†æå…§å®¹è«‹åé‡å­¸ç¿’èˆ‡è€ƒè©¦å°ˆæ³¨åŠ›ã€å­¸ç¿’æ–¹æ³•å»ºè­°ã€‚`;
                        } else {
                            prompt += `\nç¾åœ¨è«‹é‡å°ä½¿ç”¨è€…çš„ã€Œäº‹æ¥­é‹å‹¢ã€æä¾›ç°¡çŸ­åˆ†æå’Œæç¤ºèªã€‚\nåˆ†æå…§å®¹è«‹åé‡äººéš›ç­–ç•¥ã€èƒ½é‡åˆ†é…ã€è·å ´ç™¼å±•å»ºè­°ã€‚`;
                        }
                        prompt += `\nè«‹ä¾ç…§å‘½ç›¤äº”è¡Œï¼ˆæ ¹æ“šç´«å¾®æ–—æ•¸ä¸»æ˜Ÿå’Œå‘½å®®ç°¡åŒ–åˆ¤æ–·ï¼‰ã€å®®ä½ç‰¹è³ªæä¾›å»ºè­°ã€‚è«‹åœ¨é–‹é ­åŒ…å«ä¸€å€‹ç°¡å–®çš„äº‹æ¥­ï¼å­¸æ¥­èƒ½é‡æŒ‡æ•¸ï¼Œä¾‹å¦‚ï¼šã€Œäº‹æ¥­ï¼å­¸æ¥­èƒ½é‡ï¼šâ˜…â˜…â˜…â˜…â˜†ã€ã€‚`;
                        break;
                    case 'family':
                        prompt += `\nç¾åœ¨è«‹é‡å°ä½¿ç”¨è€…çš„ã€Œå®¶åº­é—œä¿‚ã€æä¾›ç°¡çŸ­åˆ†æå’Œæç¤ºèªã€‚\nåˆ†æå…§å®¹è«‹ä»¥å‘½ç›¤ä¸­çš„é—œä¿‚å®®ï¼ˆå¦‚å…„å¼Ÿã€å¤«å¦»ã€çˆ¶æ¯ç­‰ï¼Œè«‹æ ¹æ“šç´«å¾®æ–—æ•¸å‘½å®®å’Œä¸»æ˜Ÿç°¡åŒ–æ¨æ–·ï¼Œæˆ–ä»¥ç”Ÿå‘½éˆæ•¸ç‰¹è³ªæ¨æ–·ï¼‰åšå‡ºç°¡åŒ–è©®é‡‹ã€‚\nå»ºè­°èªé¢¨æ ¼æº«å’Œã€å¼•å°åæ€å³å¯ï¼Œä¸æ–·è¨€å‰å‡¶ã€‚è«‹åœ¨é–‹é ­åŒ…å«ä¸€å€‹ç°¡å–®çš„å®¶åº­å’Œè«§æŒ‡æ•¸ï¼Œä¾‹å¦‚ï¼šã€Œå®¶åº­å’Œè«§æŒ‡æ•¸ï¼šâ˜…â˜…â˜…â˜…â˜†ã€ã€‚`;
                        break;
                    case 'overall':
                        prompt += `\nç¾åœ¨è«‹é‡å°ä½¿ç”¨è€…ç•¶å‰æ™‚é–“ï¼ˆ${currentYear}å¹´${currentMonth}æœˆ${currentDay}æ—¥ï¼Œæ˜ŸæœŸ${['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][currentWeekDay]}ï¼‰çš„ã€Œç¶œåˆé‹å‹¢ã€æä¾›ç°¡çŸ­åˆ†æå’Œæç¤ºèªã€‚\nåˆ†æå…§å®¹å¯åŒ…å«ç¸½é«”ç‹€æ…‹å»ºè­°ï¼Œä¾‹å¦‚ã€Œè¡Œå‹•åŠ›ä¸Šå‡ï¼éœ€å¤šä¼‘æ¯ã€ã€‚è«‹çµåˆå‘½ç›¤è³‡æ–™å’Œç•¶é€±ï¼ˆæˆ–ç•¶æœˆï¼‰æµæ—¥ã€æµå¹´è³‡æ–™ï¼ˆè«‹æ¨¡æ“¬æµæ—¥æµå¹´å°å‘½ç›¤çš„å½±éŸ¿ï¼‰ã€‚è«‹åœ¨é–‹é ­åŒ…å«ä¸€å€‹ç°¡å–®çš„æ•´é«”é‹å‹¢æŒ‡æ•¸ï¼Œä¾‹å¦‚ï¼šã€Œæ•´é«”é‹å‹¢ï¼šâ˜…â˜…â˜…â˜†â˜†ã€ã€‚`;
                        break;
                }

                try {
                    // Call Gemini 2.0 Flash API
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // If you want to use models other than gemini-2.0-flash or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    let thematicResponseText = "æŠ±æ­‰ï¼Œç›®å‰ç„¡æ³•æä¾›è©²ä¸»é¡Œçš„é‹å‹¢è§£æã€‚";

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        thematicResponseText = result.candidates[0].content.parts[0].text;
                        thematicFortuneCache[theme] = thematicResponseText; // Cache the response
                        console.log(`AI è§£ææˆåŠŸï¼Œä¸»é¡Œ ${theme} çš„å…§å®¹å·²è¼‰å…¥ã€‚`); // Debug log
                    } else {
                        console.error("LLM response structure unexpected for thematic fortune:", result); // Debug log
                    }
                    activeContentDiv.innerHTML = thematicResponseText;

                } catch (error) {
                    console.error(`Error communicating with Chatbot API for ${theme} fortune:`, error); // Debug log
                    activeContentDiv.innerHTML = `æŠ±æ­‰ï¼Œç›®å‰ç„¡æ³•ç‚ºæ‚¨è§£æ${activeTabButton.textContent.split(' ')[0]}ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚`;
                } finally {
                    thematicLoading.style.display = 'none'; // Hide thematic loading indicator
                    console.log(`ä¸»é¡Œ ${theme} çš„è¼‰å…¥ç‹€æ…‹å·²å®Œæˆã€‚`); // Debug log
                }
            }


            // --- Chatbot Logic ---
            sendMessageBtn.addEventListener('click', async () => {
                await sendChatMessage();
            });

            chatInput.addEventListener('keypress', async (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); // Prevent new line in input
                    await sendChatMessage();
                }
            });

            async function sendChatMessage() {
                const userMessage = chatInput.value.trim();
                if (!userMessage) {
                    showMessageBox('è¼¸å…¥ç©ºç™½', 'è«‹è¼¸å…¥ä½ çš„å•é¡Œã€‚');
                    return;
                }

                // Append user message
                appendMessage(userMessage, 'user');
                chatInput.value = ''; // Clear input
                chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight; // Scroll to bottom

                chatbotLoading.style.display = 'block'; // Show loading indicator

                try {
                    // Construct prompt for LLM
                    const prompt = `
                    ä½ æ˜¯ä¸€å€‹æº«æŸ”ã€å®‰éœã€é™ªä¼´å¼çš„å‘½ç† Chatbotï¼Œä½ çš„åå­—æ˜¯ã€Œæ˜Ÿæ˜Ÿã€ã€‚å“ç‰Œåç¨±æ˜¯ã€Œå¿ƒéˆæ—…ç¨‹ã€ã€‚
                    ä½ çš„ä»»å‹™æ˜¯æ ¹æ“šä½¿ç”¨è€…çš„å‘½æ ¼ç‰¹è³ªï¼Œæä¾›å€‹äººåŒ–å»ºè­°èˆ‡è§£æã€‚
                    å›ç­”å…§å®¹éœ€æ ¹æ“šå‘½æ ¼ç‰¹è³ªèª¿æ•´ï¼Œé¿å…æ³›æ³›è€Œè«‡ã€‚
                    **è«‹åœ¨å›ç­”ä¸­å¼·èª¿ä½¿ç”¨è€…çš„ç”Ÿå‘½éˆæ•¸ä¸»å‘½æ•¸ã€ç´«å¾®æ–—æ•¸ä¸»æ˜Ÿå’Œå‘½å®®æ‰€ä»£è¡¨çš„ç‰¹è³ªï¼Œä½†ä¸è¦ç›´æ¥æåŠã€Œç”Ÿå‘½éˆæ•¸ä¸»å‘½æ•¸ã€ã€ã€Œç´«å¾®æ–—æ•¸ä¸»æ˜Ÿã€ã€ã€Œç´«å¾®æ–—æ•¸å‘½å®®ã€ç­‰è¡“èªï¼Œè€Œæ˜¯å°‡é€™äº›ç‰¹è³ªè‡ªç„¶åœ°èå…¥å»ºè­°ä¸­ã€‚**
                    å›ç­”èªæ°£ä¿æŒæº«æŸ”ã€é™ªä¼´ã€æœ‰å•Ÿç™¼æ€§ï¼Œä¸èª‡å¼µä¸ç¥ç§˜ã€‚
                    å›ç­”é•·åº¦é©ä¸­ï¼Œèƒ½è®“ä½¿ç”¨è€…æ„Ÿè¦ºåƒåœ¨èˆ‡ä¸€ä½çŸ¥å¿ƒæœ‹å‹èŠå¤©ã€‚
                    é¿å…å‘½é‹çµ•å°è«–ï¼Œå¼·èª¿ã€Œå»ºè­°ã€èˆ‡ã€Œé™ªä¼´ã€çš„æ…‹åº¦ã€‚
                    è«‹åœ¨å›ç­”ä¸­å¤šä½¿ç”¨ä¸€äº›æº«æš–ã€å‹å–„çš„emojiï¼Œä¾‹å¦‚ï¼šâœ¨ğŸŒ¸ğŸ’–ğŸŒŸğŸ˜ŠğŸ’¡ğŸŒ±ã€‚
                    **è«‹å°‡å›ç­”åˆ†æ®µï¼Œä½¿ç”¨ç©ºè¡Œéš”é–‹ï¼Œè®“å…§å®¹æ›´èˆ’æœã€å¥½é–±è®€ï¼Œé¿å…ä½¿ç”¨ç¬¦è™Ÿï¼ˆå¦‚ '*'ï¼‰ä¾†åˆ†æ®µã€‚**
                    **å¦‚æœéœ€è¦åˆ—é»ï¼Œè«‹ä½¿ç”¨ Markdown çš„åˆ—é»ç¬¦è™Ÿï¼ˆä¾‹å¦‚ï¼š'- é …ç›®' æˆ– '* é …ç›®'ï¼‰ï¼Œä¸¦ç¢ºä¿æ¯å€‹åˆ—é»ä¹‹é–“æœ‰ç©ºè¡Œã€‚**

                    ä»¥ä¸‹æ˜¯ä½¿ç”¨è€…çš„å‘½æ ¼è³‡æ–™ï¼š
                    å§“å: ${userFortuneData.name || 'æœªæä¾›'}
                    å‡ºç”Ÿæ—¥æœŸ: ${userFortuneData.birthDate}
                    å‡ºç”Ÿæ™‚é–“: ${userFortuneData.birthTime}
                    æ€§åˆ¥: ${userFortuneData.gender === 'male' ? 'ç”·' : 'å¥³'}
                    ç”Ÿå‘½éˆæ•¸ä¸»å‘½æ•¸: ${userFortuneData.lifepath_number} - ${userFortuneData.lifepath_description}
                    ç´«å¾®æ–—æ•¸ä¸»æ˜Ÿ: ${userFortuneData.ziwei_main_star}
                    ç´«å¾®æ–—æ•¸å‘½å®®: ${userFortuneData.ziwei_minggong}
                    ç´«å¾®æ–—æ•¸ç°¡ä»‹: ${userFortuneData.ziwei_description}

                    ä½¿ç”¨è€…æå•: ${userMessage}
                    `;

                    // Call Gemini 2.0 Flash API
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // If you want to use models other than gemini-2.0-flash or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    let botResponseText = "æŠ±æ­‰ï¼Œç›®å‰ç„¡æ³•æä¾›å›ç­”ã€‚";

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        botResponseText = result.candidates[0].content.parts[0].text;
                    } else {
                        console.error("LLM response structure unexpected:", result);
                    }

                    appendMessage(botResponseText, 'bot');
                    chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight; // Scroll to bottom again
                } catch (error) {
                    console.error("Error communicating with Chatbot API:", error);
                    appendMessage("æŠ±æ­‰ï¼Œç›®å‰ç„¡æ³•èˆ‡ æ˜Ÿæ˜Ÿ é€£ç·šï¼Œè«‹ç¨å¾Œå†è©¦ã€‚", 'bot');
                } finally {
                    chatbotLoading.style.display = 'none';
                }
            }

            function appendMessage(text, sender) {
                const messageBubble = document.createElement('div');
                messageBubble.classList.add('message-bubble');
                if (sender === 'user') {
                    messageBubble.classList.add('user-message');
                } else {
                    messageBubble.classList.add('bot-message');
                }
                // Use innerHTML to render Markdown formatting (paragraphs, lists)
                // Note: For full Markdown rendering, a dedicated Markdown parser library would be needed.
                // Here, we rely on pre-wrap and LLM's ability to output basic paragraph/list structures.
                messageBubble.innerHTML = text;
                chatMessagesDiv.appendChild(messageBubble);
                chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight; // Ensure auto-scroll
            }

            // --- ç”Ÿå‘½éˆæ•¸é‚è¼¯ (èˆ‡ä¹‹å‰ç›¸åŒ) ---
            function sumDigits(num) {
                return String(num).split('').reduce((sum, digit) => sum + parseInt(digit), 0);
            }

            function reduceToSingleDigit(num) {
                while (num > 9 && num !== 11 && num !== 22 && num !== 33) { // User specified 1-9, so reduce master numbers too.
                    num = sumDigits(num);
                }
                return num;
            }

            function calculateLifePathNumber(year, month, day) {
                const sumYear = sumDigits(year);
                const sumMonth = sumDigits(month);
                const sumDay = sumDigits(day);

                let totalSum = sumDigits(sumYear + sumMonth + sumDay);
                return reduceToSingleDigit(totalSum);
            }

            function getNumerologyDescription(number) {
                const descriptions = {
                    1: "ä¸»å‘½æ•¸ç‚º 1 çš„ä½ ï¼Œé€šå¸¸å…·æœ‰é ˜å°ç‰¹è³ªï¼Œç¨ç«‹ã€æœ‰æ±ºå¿ƒï¼Œå–œæ­¡é–‹å‰µå’ŒæŒ‘æˆ°æ–°äº‹ç‰©ã€‚ä½ æ“æœ‰å¾ˆå¼·çš„å€‹äººæ„å¿—ï¼Œä½†ä¹Ÿå¯èƒ½é¡¯å¾—å›ºåŸ·æˆ–è‡ªæˆ‘ä¸­å¿ƒã€‚",
                    2: "ä¸»å‘½æ•¸ç‚º 2 çš„ä½ ï¼Œæº«å’Œã€æ•æ„Ÿã€åˆä½œæ€§å¼·ï¼Œæ“…é•·å”èª¿èˆ‡æºé€šã€‚ä½ æ˜¯å¾ˆå¥½çš„è†è½è€…å’Œæ”¯æŒè€…ï¼Œä½†æœ‰æ™‚æœƒéæ–¼å„ªæŸ”å¯¡æ–·æˆ–ç¼ºä¹è‡ªä¿¡ã€‚",
                    3: "ä¸»å‘½æ•¸ç‚º 3 çš„ä½ ï¼Œå……æ»¿å‰µæ„ã€æ¨‚è§€ã€å–„æ–¼è¡¨é”ï¼Œæ“æœ‰è—è¡“å¤©è³¦å’Œç¤¾äº¤é­…åŠ›ã€‚ä½ å–œæ­¡æˆç‚ºçœ¾äººç„¦é»ï¼Œä½†ä¹Ÿå¯èƒ½éæ–¼æµ®èºæˆ–ä¸åˆ‡å¯¦éš›ã€‚",
                    4: "ä¸»å‘½æ•¸ç‚º 4 çš„ä½ ï¼Œå‹™å¯¦ã€æœ‰æ¢ç†ã€è² è²¬ä»»ï¼Œæ˜¯å¯é çš„å»ºè¨­è€…ã€‚ä½ æ³¨é‡ç©©å®šå’Œå®‰å…¨ï¼Œä½†ä¹Ÿå¯èƒ½éæ–¼ä¿å®ˆæˆ–ç¼ºä¹å½ˆæ€§ã€‚",
                    5: "ä¸»å‘½æ•¸ç‚º 5 çš„ä½ ï¼Œç†±æ„›è‡ªç”±ã€é©æ‡‰åŠ›å¼·ã€å–œæ­¡è®ŠåŒ–å’Œå†’éšªã€‚ä½ å……æ»¿å¥½å¥‡å¿ƒï¼Œå‹‡æ–¼å˜—è©¦æ–°äº‹ç‰©ï¼Œä½†ä¹Ÿå¯èƒ½ç¼ºä¹ç´€å¾‹æˆ–ä¸å¤ å°ˆæ³¨ã€‚",
                    6: "ä¸»å‘½æ•¸ç‚º 6 çš„ä½ ï¼Œå¯Œæœ‰æ„›å¿ƒã€è²¬ä»»æ„Ÿå¼·ã€æ¨‚æ–¼å¥‰ç»ï¼Œæ˜¯å®¶åº­å’Œç¤¾ç¾¤çš„æ”¯æŸ±ã€‚ä½ è¿½æ±‚å’Œè«§èˆ‡å¹³è¡¡ï¼Œä½†ä¹Ÿå¯èƒ½éæ–¼çŠ§ç‰²è‡ªæˆ‘æˆ–æ„›æ“å¿ƒã€‚",
                    7: "ä¸»å‘½æ•¸ç‚º 7 çš„ä½ ï¼Œæ€æƒ³æ·±åˆ»ã€è¿½æ±‚çœŸç†ã€å…·æœ‰åˆ†æèƒ½åŠ›å’Œç›´è¦ºã€‚ä½ å–œæ­¡ç¨è™•æ€è€ƒï¼Œä½†ä¹Ÿå¯èƒ½é¡¯å¾—å­¤åƒ»æˆ–éæ–¼æ‰¹åˆ¤ã€‚",
                    8: "ä¸»å‘½æ•¸ç‚º 8 çš„ä½ ï¼Œæ“æœ‰å“è¶Šçš„é ˜å°åŠ›ã€å•†æ¥­é ­è…¦å’Œå¯¦ç¾ç›®æ¨™çš„èƒ½åŠ›ã€‚ä½ è¿½æ±‚æˆåŠŸå’Œè²¡å¯Œï¼Œä½†ä¹Ÿå¯èƒ½éæ–¼ç‰©è³ªåŒ–æˆ–æ¬ŠåŠ›æ…¾æœ›å¼·ã€‚",
                    9: "ä¸»å‘½æ•¸ç‚º 9 çš„ä½ ï¼Œå¯Œæœ‰åŒæƒ…å¿ƒã€ç†æƒ³ä¸»ç¾©ã€å…·æœ‰å»£é—Šçš„è¦–é‡å’Œæœå‹™äººç¾¤çš„ç²¾ç¥ã€‚ä½ è¿½æ±‚å¤§æ„›å’Œå¥‰ç»ï¼Œä½†ä¹Ÿå¯èƒ½éæ–¼ç†æƒ³åŒ–æˆ–æƒ…ç·’åŒ–ã€‚"
                };
                return descriptions[number] || "ç„¡æ³•æ‰¾åˆ°å°æ‡‰çš„ä¸»å‘½æ•¸è§£èªªã€‚";
            }

            // --- ç´«å¾®æ–—æ•¸ç°¡åŒ–é‚è¼¯ (èˆ‡ä¹‹å‰ç›¸åŒ) ---
            // é€™æ˜¯ä¸€å€‹æ¥µåº¦ç°¡åŒ–çš„æ¨¡æ“¬é‚è¼¯ï¼Œä¸å…·å‚™å¯¦éš›ç´«å¾®æ–—æ•¸çš„è¤‡é›œæ¨ç®—è¦å‰‡ï¼Œåƒ…ä¾›å¨›æ¨‚åƒè€ƒã€‚
            function getSimplifiedZiweiAnalysis(year, month, day, hour, gender) {
                let lifePalace = "å‘½å®®"; // Default
                let mainStar = "ä¸»æ˜Ÿ"; // Default
                let description = "ç´«å¾®æ–—æ•¸çš„åˆ†æçµæœæ˜¯åŸºæ–¼ç°¡åŒ–æ¨¡æ“¬é‚è¼¯ï¼Œåƒ…ä¾›å¨›æ¨‚åƒè€ƒã€‚";

                // ç°¡åŒ–å‘½å®®åˆ¤æ–· (åŸºæ–¼æœˆä»½å’Œæ™‚è¾°ï¼Œéå¸¸ç°¡åŒ–)
                const monthHourOffset = (month - 1) * 2 + Math.floor(hour / 2); // æ¯æœˆ2å€‹æ™‚è¾°ï¼Œç°¡åŒ–è™•ç†
                const palaces = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"];
                lifePalace = palaces[monthHourOffset % 12] + "å®®";

                // ç°¡åŒ–ä¸»æ˜Ÿåˆ¤æ–· (åŸºæ–¼å‡ºç”Ÿå¹´ä»½çš„æœ€å¾Œä¸€ä½æ•¸å­—å’Œæ€§åˆ¥ï¼Œç´”ç²¹æ¨¡æ“¬)
                const lastDigitOfYear = year % 10;
                let starIndex = (lastDigitOfYear + (gender === 'male' ? 0 : 5)) % 12; // ç°¡å–®åç§»
                const mainStars = [
                    "ç´«å¾®æ˜Ÿ", "å¤©åºœæ˜Ÿ", "å¤ªé™½æ˜Ÿ", "æ­¦æ›²æ˜Ÿ",
                    "å¤©åŒæ˜Ÿ", "å»‰è²æ˜Ÿ", "å¤©ç›¸æ˜Ÿ", "å·¨é–€æ˜Ÿ",
                    "å¤©æ¢æ˜Ÿ", "ä¸ƒæ®ºæ˜Ÿ", "ç ´è»æ˜Ÿ", "è²ªç‹¼æ˜Ÿ"
                ];
                mainStar = mainStars[starIndex];

                // ç°¡åŒ–ä¸»æ˜Ÿæè¿° (èˆ‡ä¸»æ˜Ÿå°æ‡‰ï¼Œä½†å…§å®¹ç‚ºé€šç”¨å‹)
                const starDescriptions = {
                    "ç´«å¾®æ˜Ÿ": "ä½ å¯èƒ½å…·æœ‰é ˜å°æ½›è³ªï¼Œé‡è¦–å°Šåš´ï¼Œæœ‰ç‹è€…é¢¨ç¯„ã€‚",
                    "å¤©åºœæ˜Ÿ": "ä½ å¯èƒ½æ€§æ ¼ç©©é‡ï¼Œå–„æ–¼ç†è²¡ï¼Œæœ‰åŒ…å®¹åŠ›ã€‚",
                    "å¤ªé™½æ˜Ÿ": "ä½ å¯èƒ½ç†±æƒ…é–‹æœ—ï¼Œæ¨‚æ–¼åŠ©äººï¼Œæœ‰æœå‹™ç²¾ç¥ã€‚",
                    "æ­¦æ›²æ˜Ÿ": "ä½ å¯èƒ½å …æ¯…æœæ–·ï¼Œæœ‰åŸ·è¡ŒåŠ›ï¼Œè²¡é‹æ–¹é¢æœ‰æ½›åŠ›ã€‚",
                    "å¤©åŒæ˜Ÿ": "ä½ å¯èƒ½æº«å’Œå–„è‰¯ï¼Œæ€§æƒ…éš¨å’Œï¼Œå–œæ­¡äº«æ¨‚ã€‚",
                    "å»‰è²æ˜Ÿ": "ä½ å¯èƒ½å‰›æ¯…æœæ±ºï¼Œæœ‰åŸå‰‡ï¼Œä½†ä¹Ÿå¯èƒ½å¸¶æœ‰å›é€†æ€§ã€‚",
                    "å¤©ç›¸æ˜Ÿ": "ä½ å¯èƒ½æº«æ–‡å„’é›…ï¼Œæ³¨é‡å„€è¡¨ï¼Œæ¨‚æ–¼åŠ©äººã€‚",
                    "å·¨é–€æ˜Ÿ": "ä½ å¯èƒ½å£æ‰å‡ºçœ¾ï¼Œå–„æ–¼åˆ†æï¼Œä½†ä¹Ÿå¯èƒ½å¤šç–‘ã€‚",
                    "å¤©æ¢æ˜Ÿ": "ä½ å¯èƒ½æˆç†Ÿç©©é‡ï¼Œæ¨‚æ–¼æ–½æ©ï¼Œæœ‰è§£å„æ¶ˆç½ä¹‹èƒ½åŠ›ã€‚",
                    "ä¸ƒæ®ºæ˜Ÿ": "ä½ å¯èƒ½ç¨ç«‹æ€§å¼·ï¼Œæ•¢æ–¼é–‹å‰µï¼Œæœ‰å†’éšªç²¾ç¥ã€‚",
                    "ç ´è»æ˜Ÿ": "ä½ å¯èƒ½è®Šå‹•æ€§å¤§ï¼Œæ•¢æ–¼ç ´èˆŠç«‹æ–°ï¼Œä¸æ‹˜å°ç¯€ã€‚",
                    "è²ªç‹¼æ˜Ÿ": "ä½ å¯èƒ½å¤šæ‰å¤šè—ï¼Œå–„æ–¼äº¤éš›ï¼Œå°æ…¾æœ›æœ‰è¼ƒå¼·è¿½æ±‚ã€‚"
                };
                description = starDescriptions[mainStar] || description;

                return {
                    lifePalace: lifePalace,
                    mainStar: mainStar,
                    description: description
                };
            }
        });
    </script>
</body>
</html>
